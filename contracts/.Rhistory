# mutate(customer = as.factor(customer)) %>%
mutate(category = as.factor(category)) %>%
as.data.frame(.)
dla_category <- engine_contracts %>%
filter(customer == "DLA") %>%
group_by(fy, category) %>%
dplyr::summarise(amount = sum(amount, na.rm = TRUE)) %>%
as.data.frame(.)
# # select(fy, amount, customer, category) %>%
dla <- dla %>%
rbind(dla_category) %>%
mutate(customer = "DLA")
(super_facet <- total %>%
rbind(army, navy, air_force, dla) %>%
mutate(customer = factor(customer, levels = c("Army",
"Navy",
"Air Force",
"DLA",
"Total")),
category = factor(category, levels = c("Products",
"Services",
"R&D",
"Total"))) %>%
ggplot() +
geom_area(aes(x = fy, y = amount), alpha = .9) +
facet_grid(category ~ customer) +
chart_theme +
xlab("fiscal year") +
ylab("constant fy18 dollars") +
scale_y_continuous(labels = money_labels) +
scale_x_continuous(breaks = seq(2000, 2020, by = 2),
labels = function(x) {substring(as.character(x), 3, 4)}))
ggsave("charts/super_facet.svg", super_facet,
device = "svg", width = 12, height = 10, units = "in")
# parent (top 12) ----------------------------------------------------------------
parent_rank <- engine_contracts %>%
group_by(parent) %>%
summarise(amount = sum(amount, na.rm = TRUE)) %>%
arrange(desc(amount))
parent_rank_12 <- parent_rank[c(1:12), ]
parent_rank_other <- parent_rank[-c(1:12), -1]
parent_rank_other <- parent_rank_other %>%
summarise(amount = sum(amount, na.rm = TRUE)) %>%
mutate(parent = "NULL") %>%
select(parent, amount)
parent_rank <- parent_rank_12 %>%
rbind(parent_rank_other) %>%
group_by(parent) %>%
summarise(amount = sum(amount, na.rm = TRUE)) %>%
select(parent) %>%
left_join(engine_contracts)
parent_rank$parent <- as.character(parent_rank$parent)
parent_rank$parent[parent_rank$parent == "GE ROLLS-ROYCE FIGHTER ENGINE TEAM [GE/ROLLS ROYCE]"] <-
"GE/ROLLS ROYCE JV"
parent_rank$parent[parent_rank$parent == "KELLY AVIATION CENTER [Joint Venture Lockheed Martin/Rolls Royce]"] <-
"LOCKHEED/ROLLS ROYCE JV"
parent_rank$parent[parent_rank$parent == "NULL"] <-
"OTHER"
parent_rank$parent[parent_rank$parent == "UNITED TECH"] <-
"UNITED TECHNOLOGIES"
(
parent <- parent_rank %>%
group_by(fy, parent) %>%
dplyr::summarise(amount = sum(amount, na.rm = TRUE)) %>%
mutate(parent = factor(parent, levels = c(
"UNITED TECHNOLOGIES",
"GENERAL ELECTRIC",
"OTHER",
"ROLLS ROYCE",
"HONEYWELL",
"TEXTRON",
"GE/ROLLS ROYCE JV",
"LOCKHEED/ROLLS ROYCE JV",
"CFM INTERNATIONAL",
"BOEING",
"L3 COMMUNICATIONS",
"NORTHROP GRUMMAN"))) %>%
ggplot() +
geom_area(aes(y = amount, x = fy), alpha = .9, stat = "identity") +
facet_wrap(~ parent) +
chart_theme +
ggtitle("DoD contract obligations - top 12 engine contractors") +
xlab("fiscal year") +
ylab("constant fy18 dollars") +
scale_y_continuous(labels = money_labels) +
scale_x_continuous(breaks = seq(2000, 2020, by = 2),
labels = function(x) {substring(as.character(x), 3, 4)})
)
ggsave("charts/top_12.svg", parent,
device = "svg", width = 12, height = 10, units = "in")
# GE vs Pratt --------------------------------------------------------------------
(
parent <- engine_contracts %>%
filter(parent %in% c("UNITED TECH",
"GENERAL ELECTRIC")) %>%
group_by(fy, parent, customer) %>%
dplyr::summarise(amount = sum(amount, na.rm = TRUE)) %>%
ggplot() +
geom_area(aes(y = amount, x = fy), stat = "identity") +
facet_grid(customer ~ parent) +
chart_theme +
ggtitle("DoD contract obligations - GE vs Pratt") +
xlab("fiscal year")
)
# ggsave("charts/DoD contract obligations - GE vs Pratt.svg", parent,
#        device = "svg", width = 8, height = 6, units = "in")
# project (top 17) ---------------------------------------------------------------
(project <- engine_contracts %>%
filter(project %in% c("NULL",
"JSF (F-35) ",
"F/A-22 ",
"F-100 Engine",
"H-1 UPGRADE ",
"V22 ",
"F/A-18 E/F ",
"BJN",
"C-17A ",
"C-17A CARGO TRANSPORT",
"F-110",
"F414-GE-400",
"C130-J ",
"BLACK HAWK (UH-60A/L) ",
"UH-60 BLACKHAWK UTTAS",
"BSJ",
"F-18 HORNET"
)) %>%
group_by(fy, project) %>%
dplyr::summarise(amount = sum(amount, na.rm = TRUE)) %>%
ggplot() +
geom_area(aes(y = amount, x = fy), stat = "identity") +
facet_wrap(~ project) +
chart_theme +
ggtitle("DoD contract obligations - top 17 engine projects") +
xlab("fiscal year")
)
# ggsave("charts/DoD contract obligations - top 17 engine projects.svg", project,
#        device = "svg", width = 8, height = 6, units = "in")
# --------------------------------------------------------------------------------
# jsf
# --------------------------------------------------------------------------------
(project <- engine_contracts %>%
filter(project %in% c(
"JSF (F-35) "
)) %>%
group_by(fy, project) %>%
dplyr::summarise(amount = sum(amount, na.rm = TRUE)) %>%
ggplot() +
geom_area(aes(y = amount, x = fy), stat = "identity") +
facet_wrap(~ project) +
chart_theme +
ggtitle("DoD contract obligations - JSF") +
xlab("fiscal year")
)
# ggsave("charts/DoD contract obligations - JSF.svg", project,
#        device = "svg", width = 8, height = 6, units = "in")
# comparison to the topline ======================================================
# join engines and topline -------------------------------------------------------
engine_contracts <- engine_contracts %>%
mutate(type = "Engines")
topline_contracts <- topline_contracts %>%
mutate(type = "Topline")
engine_contracts <- engine_contracts %>%
select(fy, customer, category, amount, type)
comparison_contracts_og <- engine_contracts %>%
rbind(topline_contracts) %>%
group_by(fy, type) %>%
dplyr::summarise(amount = sum(amount, na.rm = TRUE))
dyear <- comparison_contracts_og %>%
dplyr::rename(fyb = fy) %>%
mutate(fy = fyb + 1) %>%
select(-fyb)
(comparison_contracts <- comparison_contracts_og %>%
left_join(dyear, by = c("fy", "type")) %>%
filter(fy >= 2001) %>%
select(fy, amount.x, amount.y, type) %>%
mutate(amount_change = amount.x - amount.y) %>%
mutate(amount_percent_change = (amount_change) / amount.y * 100) %>%
dplyr::rename(amount = amount.x) %>%
select(fy, amount, amount_change, amount_percent_change, type) %>%
group_by(fy, type) %>%
dplyr::summarise(
amount = sum(amount, na.rm = TRUE),
amount_change = sum(amount_change, na.rm = TRUE),
amount_percent_change = sum(amount_percent_change, na.rm = TRUE)
))
# difference in amount -----------------------------------------------------------
(diff.amount <- ggplot(data = comparison_contracts) +
geom_line(aes(
x = fy,
y = amount,
group = type,
color = type
)) +
geom_hline(yintercept = 0) +
theme_minimal() +
xlab("fiscal year") +
ggtitle("difference in amount") +
theme(plot.title = element_text(hjust = 0.5)))
# M: I added x-axis label, I named it so I could refer to it, and
# I centered the title
# ggsave("charts/difference in amount.svg", diff.amount,
#        device = "svg", width = 8, height = 6, units = "in")
# difference in year-to-year change ----------------------------------------------
diff.year <- ggplot(data = comparison_contracts) +
geom_line(aes(
x = fy,
y = amount_change,
group = type,
color = type
)) +
geom_hline(yintercept = 0) +
theme_minimal() +
xlab("Fiscal Year") +
ylab("Amount") +
ggtitle("difference in year-to-year change")+
theme(plot.title = element_text(hjust = 0.5))
# M: I added x-axis label, I named it so I could refer to it, and
# I centered the title
# ggsave("charts/difference in year-to-year change.svg", diff.year,
#        device = "svg", width = 8, height = 6, units = "in")
# --------------------------------------------------------------------------------
# difference in year-to-year % change
# filter(fy <= 2017) %>%
# mutate(fy = as.factor(as.character(fy)))
diff.percent <- ggplot(data = comparison_contracts) +
geom_line(aes(
x = fy,
y = amount_percent_change,
group = type,
color = type
)) +
geom_hline(yintercept = 0) +
theme_minimal() +
xlab("Fiscal Year") +
ylab("Amount") +
ggtitle("difference in year-to-year % change") +
theme(plot.title = element_text(hjust = 0.5))
# M: I added x-axis label, I named it so I could refer to it, and
# I centered the title
# ggsave("charts/difference in year-to-year percent change.svg", diff.percent,
#        device = "svg", width = 8, height = 6, units = "in")
# --------------------------------------------------------------------------------
# percent change
# --------------------------------------------------------------------------------
base_year <- engine_contracts %>%
group_by(fy, type) %>%
dplyr::summarise(amount = sum(amount, na.rm = TRUE))
dyear <- base_year %>%
filter(fy == 2000) %>%
select(amount, type)
# rename(fyb = fy) %>%
# mutate(fy = fyb + 1) %>%
# select(-fyb)
base_year <- base_year %>%
left_join(dyear, by = "type") %>%
select(- fy.y) %>%
mutate(amount_change = amount.x - amount.y) %>%
mutate(amount_percent_change = (amount_change) / amount.y * 100) %>%
mutate(base = 100) %>%
mutate(amount = base + amount_percent_change)
# --------------------------------------------------------------------------------
# percent change, by customer
# --------------------------------------------------------------------------------
base_year <- engine_contracts %>%
group_by(fy, type, customer) %>%
dplyr::summarise(amount = sum(amount, na.rm = TRUE))
dyear <- base_year %>%
filter(fy == 2000) %>%
select(amount, type, customer)
(base_year <- base_year %>%
left_join(dyear, by = c("type", "customer")) %>%
filter(customer != "Other DoD") %>%
select(- fy.y) %>%
mutate(amount_change = amount.x - amount.y) %>%
mutate(amount_percent_change = (amount_change) / amount.y * 100) %>%
mutate(base = 0) %>%
mutate(amount = base + amount_percent_change) %>%
dplyr::rename(fy = fy.x) %>%
group_by(fy, customer) %>%
dplyr::summarise(amount = sum(amount, na.rm = TRUE)) %>%
mutate(customer = factor(customer, levels = c("Army",
"Navy",
"Air Force",
"DLA"))) %>%
mutate(amount = amount / 100)
)
(plot_base <- ggplot(base_year) +
geom_line(aes(x = fy, y = amount), alpha = .9, color = "#554449", size = 1) +
geom_hline(yintercept = 0, alpha = .5, color = "#554449", size = .5, linetype = "dotted") +
facet_wrap( ~ customer) +
chart_theme +
ggtitle("Change in aircraft engine contract obligations from 2000") +
xlab("fiscal year") +
ylab(NULL) +
scale_y_continuous(labels = percent) +
scale_x_continuous(breaks = seq(2000, 2020, by = 2),
labels = function(x) {substring(as.character(x), 3, 4)})
)
ggsave("charts/amount_change.svg", plot_base,
device = "svg", width = 8, height = 6, units = "in")
# percent change comparison -- ---------------------------------------------------
base_year <- engine_contracts %>%
as.tibble(.) %>%
group_by(fy, type, customer) %>%
dplyr::summarise(amount = sum(amount, na.rm = TRUE))
dyear <- base_year %>%
filter(fy == 2000) %>%
select(amount, type, customer)
# rename(fyb = fy) %>%
# mutate(fy = fyb + 1) %>%
# select(-fyb)
base_year.eng <- base_year %>%
left_join(dyear, by = c("type", "customer")) %>%
filter(customer != "Other DoD") %>%
select(- fy.y) %>%
mutate(amount_change = amount.x - amount.y) %>%
mutate(amount_percent_change = (amount_change) / amount.y * 100) %>%
mutate(base = 0) %>%
mutate(amount = base + amount_percent_change) %>%
dplyr::rename(fy = fy.x) %>%
group_by(fy, customer) %>%
dplyr::summarise(amount = sum(amount, na.rm = TRUE)) %>%
mutate(data_type = "engine") %>%
mutate(amount = amount / 100)
base_year <- topline_contracts %>%
group_by(fy, type, customer) %>%
dplyr::summarise(amount = sum(amount, na.rm = TRUE))
dyear <- base_year %>%
filter(fy == 2000) %>%
select(amount, type, customer)
# rename(fyb = fy) %>%
# mutate(fy = fyb + 1) %>%
# select(-fyb)
base_year.top <- base_year %>%
left_join(dyear, by = c("type", "customer")) %>%
filter(customer != "Other DoD") %>%
select(- fy.y) %>%
mutate(amount_change = amount.x - amount.y) %>%
mutate(amount_percent_change = (amount_change) / amount.y * 100) %>%
mutate(base = 0) %>%
mutate(amount = base + amount_percent_change) %>%
dplyr::rename(fy = fy.x) %>%
group_by(fy, customer) %>%
dplyr::summarise(amount = sum(amount, na.rm = TRUE)) %>%
mutate(data_type = "topline") %>%
mutate(amount = amount / 100)
eng.topline <- rbind(base_year.eng, base_year.top)
(eng.topline1 <- eng.topline %>%
filter(customer != "NULL" & customer != "MDA") %>%
mutate(customer = factor(customer, levels = c("Total",
"Army",
"Navy",
"Air Force",
"DLA"))) %>%
mutate(data_type = factor(data_type, levels = c("topline", "engine"))) %>%
ggplot() +
geom_line(aes(x = fy, y = amount), alpha = .9, color = "#554449", size = 1) +
geom_hline(yintercept = 0, alpha = .5, color = "#554449", size = .5, linetype = "dotted") +
facet_grid(data_type ~ customer) +
chart_theme +
#scale_x_continuous(breaks = seq(2000, 2020, by = 2),
#labels = function(x) {substring(as.character(x), 3, 4)})+
#scale_y_continuous(limits = c(0:750)) +
ggtitle("Change in contract obligations from 2000") +
xlab("fiscal year") +
ylab(NULL) +
scale_y_continuous(labels = percent) +
scale_x_continuous(breaks = seq(2000, 2020, by = 2),
labels = function(x) {substring(as.character(x), 3, 4)})
)
ggsave("charts/amount_change_customer.svg", eng.topline1, width = 9, height = 6, units = "in",
device = "svg")
# percent change comparison by category ------------------------------------------
base_year <- engine_contracts %>%
as.tibble(.) %>%
group_by(fy, type, category) %>%
dplyr::summarise(amount = sum(amount, na.rm = TRUE))
dyear <- base_year %>%
filter(fy == 2000) %>%
select(amount, type, category)
# rename(fyb = fy) %>%
# mutate(fy = fyb + 1) %>%
# select(-fyb)
base_year.eng <- base_year %>%
left_join(dyear, by = c("type", "category")) %>%
# filter(customer != "Other DoD") %>%
select(- fy.y) %>%
mutate(amount_change = amount.x - amount.y) %>%
mutate(amount_percent_change = (amount_change) / amount.y * 100) %>%
mutate(base = 0) %>%
mutate(amount = base + amount_percent_change) %>%
dplyr::rename(fy = fy.x) %>%
group_by(fy, category) %>%
dplyr::summarise(amount = sum(amount, na.rm = TRUE)) %>%
mutate(data_type = "engine") %>%
mutate(amount = amount / 100)
base_year <- topline_contracts %>%
group_by(fy, type, category) %>%
dplyr::summarise(amount = sum(amount, na.rm = TRUE))
dyear <- base_year %>%
filter(fy == 2000) %>%
select(amount, type, category)
# rename(fyb = fy) %>%
# mutate(fy = fyb + 1) %>%
# select(-fyb)
base_year.top <- base_year %>%
left_join(dyear, by = c("type", "category")) %>%
# filter(customer != "Other DoD") %>%
select(- fy.y) %>%
mutate(amount_change = amount.x - amount.y) %>%
mutate(amount_percent_change = (amount_change) / amount.y * 100) %>%
mutate(base = 0) %>%
mutate(amount = base + amount_percent_change) %>%
dplyr::rename(fy = fy.x) %>%
group_by(fy, category) %>%
dplyr::summarise(amount = sum(amount, na.rm = TRUE)) %>%
mutate(data_type = "topline") %>%
mutate(amount = amount / 100)
eng.topline <- rbind(base_year.eng, base_year.top)
(eng.topline1 <- eng.topline %>%
filter(category != "NULL" & category != "MDA") %>%
mutate(category = factor(category, levels = c("Product",
"Services",
"R&D"))) %>%
mutate(data_type = factor(data_type, levels = c("topline", "engine"))) %>%
ggplot() +
geom_line(aes(x = fy, y = amount), alpha = .9, color = "#554449", size = 1) +
geom_hline(yintercept = 0, alpha = .5, color = "#554449", size = .5, linetype = "dotted") +
facet_grid(data_type ~ category) +
chart_theme +
#scale_x_continuous(breaks = seq(2000, 2020, by = 2),
#labels = function(x) {substring(as.character(x), 3, 4)})+
#scale_y_continuous(limits = c(0:750)) +
ggtitle("Change in contract obligations from 2000") +
xlab("fiscal year") +
ylab(NULL) +
scale_y_continuous(labels = percent) +
scale_x_continuous(breaks = seq(2000, 2020, by = 2),
labels = function(x) {substring(as.character(x), 3, 4)})
)
ggsave("charts/amount_change_category.svg", eng.topline1, width = 9, height = 6, units = "in",
device = "svg")
# percent change comparison ------------------------------------------------------
base_year <- engine_contracts %>%
as.tibble(.) %>%
group_by(fy, type) %>%
dplyr::summarise(amount = sum(amount, na.rm = TRUE))
dyear <- base_year %>%
filter(fy == 2000) %>%
select(amount, type)
# rename(fyb = fy) %>%
# mutate(fy = fyb + 1) %>%
# select(-fyb)
base_year.eng <- base_year %>%
left_join(dyear, by = "type") %>%
# filter(customer != "Other DoD") %>%
select(- fy.y) %>%
mutate(amount_change = amount.x - amount.y) %>%
mutate(amount_percent_change = (amount_change) / amount.y * 100) %>%
mutate(base = 0) %>%
mutate(amount = base + amount_percent_change) %>%
dplyr::rename(fy = fy.x) %>%
group_by(fy) %>%
dplyr::summarise(amount = sum(amount, na.rm = TRUE)) %>%
mutate(data_type = "engine") %>%
mutate(amount = amount / 100)
base_year <- topline_contracts %>%
group_by(fy, type) %>%
dplyr::summarise(amount = sum(amount, na.rm = TRUE))
dyear <- base_year %>%
filter(fy == 2000) %>%
select(amount, type)
# rename(fyb = fy) %>%
# mutate(fy = fyb + 1) %>%
# select(-fyb)
(base_year.top <- base_year %>%
left_join(dyear, by = "type") %>%
# filter(customer != "Other DoD") %>%
select(- fy.y) %>%
mutate(amount_change = amount.x - amount.y) %>%
mutate(amount_percent_change = (amount_change) / amount.y * 100) %>%
mutate(base = 0) %>%
mutate(amount = base + amount_percent_change) %>%
dplyr::rename(fy = fy.x) %>%
group_by(fy) %>%
dplyr::summarise(amount = sum(amount, na.rm = TRUE)) %>%
mutate(data_type = "topline") %>%
mutate(amount = amount / 100))
eng.topline <- rbind(base_year.eng, base_year.top)
(eng.topline1 <- eng.topline %>%
# filter(category != "NULL" & category != "MDA") %>%
# mutate(category = factor(category, levels = c("Product",
#                                               "Services",
#                                               "R&D"))) %>%
mutate(data_type = factor(data_type, levels = c("topline", "engine"))) %>%
ggplot() +
geom_line(aes(x = fy, y = amount), alpha = .9, color = "#554449", size = 1) +
geom_hline(yintercept = 0, alpha = .5, color = "#554449", size = .5, linetype = "dotted") +
facet_wrap( ~ data_type) +
chart_theme +
#scale_x_continuous(breaks = seq(2000, 2020, by = 2),
#labels = function(x) {substring(as.character(x), 3, 4)})+
#scale_y_continuous(limits = c(0:750)) +
ggtitle("Change in contract obligations from 2000") +
xlab("fiscal year") +
ylab(NULL) +
scale_y_continuous(labels = percent) +
scale_x_continuous(breaks = seq(2000, 2020, by = 2),
labels = function(x) {substring(as.character(x), 3, 4)})
)
ggsave("charts/amount_change.svg", eng.topline1, width = 9, height = 6, units = "in",
device = "svg")
