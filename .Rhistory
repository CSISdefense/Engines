# spread(key=Fiscal_Year, value=Action_Obligation_OMB23_GDP21),
file="contracts/charts/percent_change_total.csv",row.names = FALSE)
# --------------------------------------------------------------------------------
# percent change comparison by SubCustomer
(
comparison_contracts_subcustomer <- comparison_contracts %>%
group_by(Fiscal_Year, SubCustomer, type) %>%
dplyr::summarise(Action_Obligation_OMB23_GDP21 = sum(Action_Obligation_OMB23_GDP21, na.rm = TRUE),
Action_Obligation_OMB23_GDP21.lagged = sum(Action_Obligation_OMB23_GDP21.lagged, na.rm = TRUE),
amount_change = sum(amount_change, na.rm = TRUE),
Action_Obligation_OMB23_GDP21.2000 = sum(Action_Obligation_OMB23_GDP21.2000, na.rm = TRUE),
baseline_change = sum(baseline_change, na.rm = TRUE)) %>%
mutate(amount_percent_change = (amount_change) / Action_Obligation_OMB23_GDP21.lagged,
baseline_percent_change = (baseline_change) / Action_Obligation_OMB23_GDP21.2000) #%>%
)
levels(factor(comparison_contracts_subcustomer$type))
max((comparison_contracts_subcustomer %>%
filter(SubCustomer=="Other DoD" &
type =="Engines"))$Action_Obligation_OMB23_GDP21
)
(
graph_contracts_subcustomer <- comparison_contracts_subcustomer %>%
filter(!is.na(SubCustomer) & SubCustomer %in% c("Total",
"Army",
"Navy",
"Air Force",
"DLA")) %>%
group_by() %>%
mutate(SubCustomer = factor(
SubCustomer, levels = c("Total",
"Army",
"Navy",
"Air Force",
"DLA"
)
)) %>%
mutate(type = factor(type, levels = c("Topline", "Engines"))) %>%
ggplot() +
geom_line(
aes(x = Fiscal_Year, y = baseline_percent_change),
alpha = .9,
color = "#554449",
size = 1
) +
geom_hline(
yintercept = 0,
alpha = .5,
color = "#554449",
size = .5,
linetype = "dotted"
) +
facet_grid(type ~ SubCustomer) +
chart_theme +
#scale_x_continuous(breaks = seq(2000, 2020, by = 2),
#labels = function(x) {substring(as.character(x), 3, 4)})+
#scale_y_continuous(limits = c(0:750)) +
ggtitle("Change in Aircraft Engine Contract Obligations") +
xlab("Fiscal Year") +
ylab("Cumulative Percent Change, Inflation Adjusted (2000=0%)") +
scale_y_continuous(labels = scales::percent) +
scale_x_continuous(
breaks = seq(2000, 2020, by = 2),
labels = function(x) {
substring(as.character(x), 3, 4)
}
)+
labs(caption="Obligations for the remainder of DoD and with an unlabeled customer are excluded from the graph.")
)
ggsave(
"contracts/charts/percent_change_customer.svg",
graph_contracts_subcustomer,
width = 9,
height = 6,
units = "in",
device = "svg"
)
write.csv(graph_contracts_subcustomer$data,# %>%
# spread(key=Fiscal_Year, value=Action_Obligation_OMB23_GDP21),
file="contracts/charts/percent_change_customer.csv",row.names = FALSE)
# --------------------------------------------------------------------------------
# percent change comparison by SimpleArea
#
(
comparison_contracts_area <- comparison_contracts %>%
group_by(Fiscal_Year, SimpleArea, type) %>%
dplyr::summarise(Action_Obligation_OMB23_GDP21 = sum(Action_Obligation_OMB23_GDP21, na.rm = TRUE),
Action_Obligation_OMB23_GDP21.lagged = sum(Action_Obligation_OMB23_GDP21.lagged, na.rm = TRUE),
amount_change = sum(amount_change, na.rm = TRUE),
Action_Obligation_OMB23_GDP21.2000 = sum(Action_Obligation_OMB23_GDP21.2000, na.rm = TRUE),
baseline_change = sum(baseline_change, na.rm = TRUE)) %>%
mutate(amount_percent_change = (amount_change) / Action_Obligation_OMB23_GDP21.lagged,
baseline_percent_change = (baseline_change) / Action_Obligation_OMB23_GDP21.2000) #%>%
)
(
graph_contracts_area <- comparison_contracts_area %>%
filter(!is.na(SimpleArea) & !SimpleArea %in% c("Services","Unlabeled")) %>%
# mutate(SimpleArea = factor(SimpleArea, levels = c("Products",
#                                               # "Services",
#                                               "R&D"))) %>%
mutate(type = factor(type, levels = c("Topline", "Engines"))) %>%
ggplot() +
geom_line(
aes(x = Fiscal_Year, y = baseline_percent_change),
alpha = .9,
color = "#554449",
size = 1
) +
geom_hline(
yintercept = 0,
alpha = .5,
color = "#554449",
size = .5,
linetype = "dotted"
) +
facet_grid(type ~ SimpleArea) +
chart_theme +
ggtitle("Change in Aircraft Engine Contract Obligations") +
xlab("Fiscal Year") +
ylab("Cumulative Percent Change, Inflation Adjusted (2000=0%)") +
scale_y_continuous(labels = scales::percent) +
scale_x_continuous(
breaks = seq(2000, 2020, by = 2),
labels = function(x) {
substring(as.character(x), 3, 4)
}
)+
labs(caption="Unlabeled and services obligations are not shown.")
)
ggsave(
"contracts/charts/percent_change_category.svg",
graph_contracts_area,
width = 9,
height = 6,
units = "in",
device = "svg"
)
write.csv(graph_contracts_area$data, #%>%
# spread(key=Fiscal_Year, value=Action_Obligation_OMB23_GDP21),
file="contracts/charts/percent_change_category.csv",row.names = FALSE)
# -----------------------------------------------------------------------------------
# Product / R&D and topline.
comparison_contracts_total <-
comparison_contracts %>%
group_by(Fiscal_Year, type) %>%
dplyr::summarise(Action_Obligation_OMB23_GDP21 = sum(Action_Obligation_OMB23_GDP21, na.rm = TRUE),
Action_Obligation_OMB23_GDP21.lagged = sum(Action_Obligation_OMB23_GDP21.lagged, na.rm = TRUE),
amount_change = sum(amount_change, na.rm = TRUE),
Action_Obligation_OMB23_GDP21.2000 = sum(Action_Obligation_OMB23_GDP21.2000, na.rm = TRUE),
baseline_change = sum(baseline_change, na.rm = TRUE)) %>%
mutate(amount_percent_change = (amount_change) / Action_Obligation_OMB23_GDP21.lagged,
baseline_percent_change = (baseline_change) / Action_Obligation_OMB23_GDP21.2000) #%>%
comparison_contracts_total$SimpleArea<-"Total"
(comparison_contracts_area_total<-rbind(comparison_contracts_total,
comparison_contracts_area)
)
summary(factor(comparison_contracts_area_total$SimpleArea))
(
graph_contracts_overall_area <- comparison_contracts_area_total %>%
filter(!is.na(SimpleArea) & !SimpleArea %in% c("Services","Unlabeled")) %>%
mutate(type = factor(type, levels = c("Topline", "Engines"))) %>%
ggplot() +
geom_line(
aes(x = Fiscal_Year,
y = baseline_percent_change,
linetype=SimpleArea),
alpha = .9,
color = "#554449",
size = 1
) +
geom_hline(
yintercept = 0,
alpha = .5,
color = "#554449",
size = .5,
linetype = "dotted"
) +
facet_wrap(~ type) +
chart_theme +
ggtitle("Change in Aircraft Engine Contract Obligations") +
xlab("Fiscal Year") +
ylab("Cumulative Percent Change, Inflation Adjusted (2000=0%)") +
scale_y_continuous(labels = scales::percent, breaks = c(-0.5,0,0.5,1,1.5)) +
scale_x_continuous(
breaks = seq(2000, 2020, by = 2),
labels = function(x) {
substring(as.character(x), 3, 4)
}
)+scale_linetype_manual(
values=c("solid","dotted","dashed")
)
)
summary(comparison_contracts$SimpleArea)
levels(comparison_contracts$SimpleArea)<-
list("Products"=c("Products","Products (All)"),
'Services'=c("Services","Services (Non-R&D)"),
"R&D"=c("R&D"),
"Total"="Total",
'Unlabeled'="Unlabeled"
)
dyear <- comparison_contracts %>%
group_by() %>%
dplyr::rename(Action_Obligation_OMB23_GDP21.lagged = Action_Obligation_OMB23_GDP21) %>%
mutate(Fiscal_Year = Fiscal_Year + 1) # %>%
engine_contracts <- engine_contracts %>%
mutate(type = "Engines")
topline_contracts <- topline_contracts %>%
mutate(type = "Topline")
colnames(topline_contracts)[colnames(topline_contracts)=="ContractingSubCustomer"]<-"SubCustomer"
# engine_contracts <- engine_contracts %>%
#   select(Fiscal_Year, SubCustomer, SimpleArea, Action_Obligation_OMB23_GDP21, type)
comparison_contracts <- engine_contracts %>%
select(Fiscal_Year, SubCustomer, SimpleArea, Action_Obligation_OMB23_GDP21, type) %>%
rbind(topline_contracts %>%
select(Fiscal_Year, SubCustomer, SimpleArea, Action_Obligation_OMB23_GDP21, type)) %>%
group_by(Fiscal_Year, SubCustomer, SimpleArea, type) %>%
dplyr::summarise(Action_Obligation_OMB23_GDP21 = sum(Action_Obligation_OMB23_GDP21, na.rm = TRUE))
comparison_contracts$SimpleArea<-factor(comparison_contracts$SimpleArea)
levels(comparison_contracts$SimpleArea)<-
list("Products"=c("Products","Products (All)"),
'Services'=c("Services","Services (Non-R&D)"),
"R&D"=c("R&D"),
"Total"="Total",
'Unlabeled'="Unlabeled"
)
dyear <- comparison_contracts %>%
group_by() %>%
dplyr::rename(Action_Obligation_OMB23_GDP21.lagged = Action_Obligation_OMB23_GDP21) %>%
mutate(Fiscal_Year = Fiscal_Year + 1) # %>%
# select(-fyb)
# comparison_contracts <- comparison_contracts %>% filter(Fiscal_Year >= 2001)
#Add lagged year
sumcheck<-sum(comparison_contracts$Action_Obligation_OMB23_GDP21,na.rm=TRUE)
comparison_contracts <- comparison_contracts %>%
left_join(dyear, by = c("Fiscal_Year", "SubCustomer", "SimpleArea", "type"))# %>%
if(sumcheck!=sum(comparison_contracts$Action_Obligation_OMB23_GDP21,na.rm=TRUE)) stop("Sum Check Error")
dyear <- comparison_contracts %>%
filter(Fiscal_Year==2000) %>%
dplyr::rename(Action_Obligation_OMB23_GDP21.2000 = Action_Obligation_OMB23_GDP21) %>%
group_by()%>%
select(-Action_Obligation_OMB23_GDP21.lagged,-Fiscal_Year)
#Add 2000
sumcheck<-sum(comparison_contracts$Action_Obligation_OMB23_GDP21,na.rm=TRUE)
comparison_contracts <- comparison_contracts %>%
left_join(dyear, by = c("SubCustomer", "SimpleArea", "type")) %>%
mutate(amount_change = Action_Obligation_OMB23_GDP21 - Action_Obligation_OMB23_GDP21.lagged,
baseline_change = Action_Obligation_OMB23_GDP21 - Action_Obligation_OMB23_GDP21.2000) #%>%
if(sumcheck!=sum(comparison_contracts$Action_Obligation_OMB23_GDP21,na.rm=TRUE)) stop("Sum Check Error")
rm(dyear)
(
comparison_contracts_overall <- comparison_contracts %>%
group_by(Fiscal_Year, type) %>%
dplyr::summarise(Action_Obligation_OMB23_GDP21 = sum(Action_Obligation_OMB23_GDP21, na.rm = TRUE),
Action_Obligation_OMB23_GDP21.lagged = sum(Action_Obligation_OMB23_GDP21.lagged, na.rm = TRUE),
amount_change = sum(amount_change, na.rm = TRUE),
Action_Obligation_OMB23_GDP21.2000 = sum(Action_Obligation_OMB23_GDP21.2000, na.rm = TRUE),
baseline_change = sum(baseline_change, na.rm = TRUE)) %>%
mutate(amount_percent_change = (amount_change) / Action_Obligation_OMB23_GDP21.lagged,
baseline_percent_change = (baseline_change) / Action_Obligation_OMB23_GDP21.2000) #%>%
# dplyr::rename(Action_Obligation_OMB23_GDP21 = Action_Obligation_OMB23_GDP21) %>%
# select(Fiscal_Year, Action_Obligation_OMB23_GDP21, amount_change, amount_percent_change, type) #%>%
# This has already been done, which is good, as I don't htink it makes sense to sum percent changes like that.
# group_by(Fiscal_Year, type) %>%
# dplyr::summarise(
#   Action_Obligation_OMB23_GDP21 = sum(Action_Obligation_OMB23_GDP21, na.rm = TRUE),
#   amount_change = sum(amount_change, na.rm = TRUE),
#   amount_percent_change = sum(amount_percent_change, na.rm = TRUE)
# )
)
# --------------------------------------------------------------------------------
# percent change comparison
#
(
graph_contracts_overall <- comparison_contracts_overall %>%
mutate(type = factor(type, levels = c("Topline", "Engines"))) %>%
ggplot() +
geom_line(
aes(x = Fiscal_Year, y = baseline_percent_change),
alpha = .9,
color = "#554449",
size = 1
) +
geom_hline(
yintercept = 0,
alpha = .5,
color = "#554449",
size = .5,
linetype = "dotted"
) +
facet_wrap(~ type) +
chart_theme +
ggtitle("Change in Aircraft Engine Contract Obligations") +
xlab("Fiscal Year") +
ylab("Cumulative Percent Change, Inflation Adjusted (2000=0%)") +
scale_y_continuous(labels = scales::percent) +
scale_x_continuous(
breaks = seq(2000, 2020, by = 2),
labels = function(x) {
substring(as.character(x), 3, 4)
}
)
)
ggsave(
"contracts/charts/percent_change_total.svg",
graph_contracts_overall,
width = 9,
height = 6,
units = "in",
device = "svg"
)
write.csv(graph_contracts_overall$data,# %>%
# spread(key=Fiscal_Year, value=Action_Obligation_OMB23_GDP21),
file="contracts/charts/percent_change_total.csv",row.names = FALSE)
# --------------------------------------------------------------------------------
# percent change comparison by SubCustomer
(
comparison_contracts_subcustomer <- comparison_contracts %>%
group_by(Fiscal_Year, SubCustomer, type) %>%
dplyr::summarise(Action_Obligation_OMB23_GDP21 = sum(Action_Obligation_OMB23_GDP21, na.rm = TRUE),
Action_Obligation_OMB23_GDP21.lagged = sum(Action_Obligation_OMB23_GDP21.lagged, na.rm = TRUE),
amount_change = sum(amount_change, na.rm = TRUE),
Action_Obligation_OMB23_GDP21.2000 = sum(Action_Obligation_OMB23_GDP21.2000, na.rm = TRUE),
baseline_change = sum(baseline_change, na.rm = TRUE)) %>%
mutate(amount_percent_change = (amount_change) / Action_Obligation_OMB23_GDP21.lagged,
baseline_percent_change = (baseline_change) / Action_Obligation_OMB23_GDP21.2000) #%>%
)
levels(factor(comparison_contracts_subcustomer$type))
max((comparison_contracts_subcustomer %>%
filter(SubCustomer=="Other DoD" &
type =="Engines"))$Action_Obligation_OMB23_GDP21
)
(
graph_contracts_subcustomer <- comparison_contracts_subcustomer %>%
filter(!is.na(SubCustomer) & SubCustomer %in% c("Total",
"Army",
"Navy",
"Air Force",
"DLA")) %>%
group_by() %>%
mutate(SubCustomer = factor(
SubCustomer, levels = c("Total",
"Army",
"Navy",
"Air Force",
"DLA"
)
)) %>%
mutate(type = factor(type, levels = c("Topline", "Engines"))) %>%
ggplot() +
geom_line(
aes(x = Fiscal_Year, y = baseline_percent_change),
alpha = .9,
color = "#554449",
size = 1
) +
geom_hline(
yintercept = 0,
alpha = .5,
color = "#554449",
size = .5,
linetype = "dotted"
) +
facet_grid(type ~ SubCustomer) +
chart_theme +
#scale_x_continuous(breaks = seq(2000, 2020, by = 2),
#labels = function(x) {substring(as.character(x), 3, 4)})+
#scale_y_continuous(limits = c(0:750)) +
ggtitle("Change in Aircraft Engine Contract Obligations") +
xlab("Fiscal Year") +
ylab("Cumulative Percent Change, Inflation Adjusted (2000=0%)") +
scale_y_continuous(labels = scales::percent) +
scale_x_continuous(
breaks = seq(2000, 2020, by = 2),
labels = function(x) {
substring(as.character(x), 3, 4)
}
)+
labs(caption="Obligations for the remainder of DoD and with an unlabeled customer are excluded from the graph.")
)
ggsave(
"contracts/charts/percent_change_customer.svg",
graph_contracts_subcustomer,
width = 9,
height = 6,
units = "in",
device = "svg"
)
write.csv(graph_contracts_subcustomer$data,# %>%
# spread(key=Fiscal_Year, value=Action_Obligation_OMB23_GDP21),
file="contracts/charts/percent_change_customer.csv",row.names = FALSE)
# --------------------------------------------------------------------------------
# percent change comparison by SimpleArea
#
(
comparison_contracts_area <- comparison_contracts %>%
group_by(Fiscal_Year, SimpleArea, type) %>%
dplyr::summarise(Action_Obligation_OMB23_GDP21 = sum(Action_Obligation_OMB23_GDP21, na.rm = TRUE),
Action_Obligation_OMB23_GDP21.lagged = sum(Action_Obligation_OMB23_GDP21.lagged, na.rm = TRUE),
amount_change = sum(amount_change, na.rm = TRUE),
Action_Obligation_OMB23_GDP21.2000 = sum(Action_Obligation_OMB23_GDP21.2000, na.rm = TRUE),
baseline_change = sum(baseline_change, na.rm = TRUE)) %>%
mutate(amount_percent_change = (amount_change) / Action_Obligation_OMB23_GDP21.lagged,
baseline_percent_change = (baseline_change) / Action_Obligation_OMB23_GDP21.2000) #%>%
)
(
graph_contracts_area <- comparison_contracts_area %>%
filter(!is.na(SimpleArea) & !SimpleArea %in% c("Services","Unlabeled")) %>%
# mutate(SimpleArea = factor(SimpleArea, levels = c("Products",
#                                               # "Services",
#                                               "R&D"))) %>%
mutate(type = factor(type, levels = c("Topline", "Engines"))) %>%
ggplot() +
geom_line(
aes(x = Fiscal_Year, y = baseline_percent_change),
alpha = .9,
color = "#554449",
size = 1
) +
geom_hline(
yintercept = 0,
alpha = .5,
color = "#554449",
size = .5,
linetype = "dotted"
) +
facet_grid(type ~ SimpleArea) +
chart_theme +
ggtitle("Change in Aircraft Engine Contract Obligations") +
xlab("Fiscal Year") +
ylab("Cumulative Percent Change, Inflation Adjusted (2000=0%)") +
scale_y_continuous(labels = scales::percent) +
scale_x_continuous(
breaks = seq(2000, 2020, by = 2),
labels = function(x) {
substring(as.character(x), 3, 4)
}
)+
labs(caption="Unlabeled and services obligations are not shown.")
)
ggsave(
"contracts/charts/percent_change_category.svg",
graph_contracts_area,
width = 9,
height = 6,
units = "in",
device = "svg"
)
write.csv(graph_contracts_area$data, #%>%
# spread(key=Fiscal_Year, value=Action_Obligation_OMB23_GDP21),
file="contracts/charts/percent_change_category.csv",row.names = FALSE)
# -----------------------------------------------------------------------------------
# Product / R&D and topline.
comparison_contracts_total <-
comparison_contracts %>%
group_by(Fiscal_Year, type) %>%
dplyr::summarise(Action_Obligation_OMB23_GDP21 = sum(Action_Obligation_OMB23_GDP21, na.rm = TRUE),
Action_Obligation_OMB23_GDP21.lagged = sum(Action_Obligation_OMB23_GDP21.lagged, na.rm = TRUE),
amount_change = sum(amount_change, na.rm = TRUE),
Action_Obligation_OMB23_GDP21.2000 = sum(Action_Obligation_OMB23_GDP21.2000, na.rm = TRUE),
baseline_change = sum(baseline_change, na.rm = TRUE)) %>%
mutate(amount_percent_change = (amount_change) / Action_Obligation_OMB23_GDP21.lagged,
baseline_percent_change = (baseline_change) / Action_Obligation_OMB23_GDP21.2000) #%>%
comparison_contracts_total$SimpleArea<-"Total"
(comparison_contracts_area_total<-rbind(comparison_contracts_total,
comparison_contracts_area)
)
summary(factor(comparison_contracts_area_total$SimpleArea))
(
graph_contracts_overall_area <- comparison_contracts_area_total %>%
filter(!is.na(SimpleArea) & !SimpleArea %in% c("Services","Unlabeled")) %>%
mutate(type = factor(type, levels = c("Topline", "Engines"))) %>%
ggplot() +
geom_line(
aes(x = Fiscal_Year,
y = baseline_percent_change,
linetype=SimpleArea),
alpha = .9,
color = "#554449",
size = 1
) +
geom_hline(
yintercept = 0,
alpha = .5,
color = "#554449",
size = .5,
linetype = "dotted"
) +
facet_wrap(~ type) +
chart_theme +
ggtitle("Change in Aircraft Engine Contract Obligations") +
xlab("Fiscal Year") +
ylab("Cumulative Percent Change, Inflation Adjusted (2000=0%)") +
scale_y_continuous(labels = scales::percent, breaks = c(-0.5,0,0.5,1,1.5)) +
scale_x_continuous(
breaks = seq(2000, 2020, by = 2),
labels = function(x) {
substring(as.character(x), 3, 4)
}
)+scale_linetype_manual(
values=c("solid","dotted","dashed")
)
)
ggsave(
"contracts/charts/percent_change_total_area.svg",
graph_contracts_overall_area,
width = 9,
height = 6,
units = "in",
device = "svg"
)
write.csv(graph_contracts_overall_area$data, #%>%
# spread(key=Fiscal_Year, value=Action_Obligation_OMB23_GDP21),
file="contracts/charts/percent_change_total_area.csv",row.names = FALSE)
