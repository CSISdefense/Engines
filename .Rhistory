chart_geom = "Bar Chart",
share = FALSE,
labels_and_colors=labels_and_colors,
# NA, #VAR.ncol
x_var="Fiscal_Year", #x_var
y_var="Action_Obligation_OMB23_GDP21", #VAR.y.variable
color_var="SimpleArea", #color_var
facet_var="SimpleArea", #facet_var
column_key=column_key,
format=TRUE,
ytextposition=FALSE
)+
# theme(strip.text.y = element_text(angle=0))+
# theme(axis.text.x = element_text(angle=90))+
#    scale_y_continuous("Percent of Obligations", labels = percent_format(accuracy=1))+
#      facet_grid(.~Competition.sum ,scales="free_x", space="free_x"
#             )+labs(title=NULL,
# x="Fiscal Year",
# y="Percent of Obligations",
# color="Competition")+
scale_y_continuous(expand=expansion(add=c(0,1e9)))+
theme(legend.position = "right")+
labs(y="Obligations (Constant 2021 $s), Variable Scale")+
facet_grid(SimpleArea~.,scales="free_y",space="free_y")
)
(
SimpleArea<-build_plot(
data=engine_contracts ,
chart_geom = "Bar Chart",
share = FALSE,
labels_and_colors=labels_and_colors,
# NA, #VAR.ncol
x_var="Fiscal_Year", #x_var
y_var="Action_Obligation_OMB23_GDP21", #VAR.y.variable
color_var="SimpleArea", #color_var
facet_var="SimpleArea", #facet_var
column_key=column_key,
format=TRUE,
ytextposition=FALSE
)+
# theme(strip.text.y = element_text(angle=0))+
# theme(axis.text.x = element_text(angle=90))+
#    scale_y_continuous("Percent of Obligations", labels = percent_format(accuracy=1))+
#      facet_grid(.~Competition.sum ,scales="free_x", space="free_x"
#             )+labs(title=NULL,
# x="Fiscal Year",
# y="Percent of Obligations",
# color="Competition")+
scale_y_continuous(expand=expansion(add=c(0,2e9)))+
theme(legend.position = "right")+
labs(y="Obligations (Constant 2021 $s), Variable Scale")+
facet_grid(SimpleArea~.,scales="free_y",space="free_y")
)
(
SimpleArea<-build_plot(
data=engine_contracts ,
chart_geom = "Bar Chart",
share = FALSE,
labels_and_colors=labels_and_colors,
# NA, #VAR.ncol
x_var="Fiscal_Year", #x_var
y_var="Action_Obligation_OMB23_GDP21", #VAR.y.variable
color_var="SimpleArea", #color_var
facet_var="SimpleArea", #facet_var
column_key=column_key,
format=TRUE,
ytextposition=FALSE
)+
# theme(strip.text.y = element_text(angle=0))+
# theme(axis.text.x = element_text(angle=90))+
#    scale_y_continuous("Percent of Obligations", labels = percent_format(accuracy=1))+
#      facet_grid(.~Competition.sum ,scales="free_x", space="free_x"
#             )+labs(title=NULL,
# x="Fiscal Year",
# y="Percent of Obligations",
# color="Competition")+
scale_y_continuous(expand=expansion(add=c(0,2e9),labels=money_labels))+
theme(legend.position = "right")+
labs(y="Obligations (Constant 2021 $s), Variable Scale")+
facet_grid(SimpleArea~.,scales="free_y",space="free_y")
)
(
SimpleArea<-build_plot(
data=engine_contracts ,
chart_geom = "Bar Chart",
share = FALSE,
labels_and_colors=labels_and_colors,
# NA, #VAR.ncol
x_var="Fiscal_Year", #x_var
y_var="Action_Obligation_OMB23_GDP21", #VAR.y.variable
color_var="SimpleArea", #color_var
facet_var="SimpleArea", #facet_var
column_key=column_key,
format=TRUE,
ytextposition=FALSE
)+
# theme(strip.text.y = element_text(angle=0))+
# theme(axis.text.x = element_text(angle=90))+
#    scale_y_continuous("Percent of Obligations", labels = percent_format(accuracy=1))+
#      facet_grid(.~Competition.sum ,scales="free_x", space="free_x"
#             )+labs(title=NULL,
# x="Fiscal Year",
# y="Percent of Obligations",
# color="Competition")+
scale_y_continuous(expand=expansion(add=c(0,2e9)))+
theme(legend.position = "right")+
labs(y="Obligations (Constant 2021 $s), Variable Scale")+
facet_grid(SimpleArea~.,scales="free_y",space="free_y")
)
ggsave600dpi(SimpleArea,file="charts/SimpleArea.png",width=5,height=6,size = 11)
(
SimpleArea<-build_plot(
data=engine_contracts ,
chart_geom = "Bar Chart",
share = FALSE,
labels_and_colors=labels_and_colors,
# NA, #VAR.ncol
x_var="Fiscal_Year", #x_var
y_var="Action_Obligation_OMB23_GDP21", #VAR.y.variable
color_var="SimpleArea", #color_var
facet_var="SimpleArea", #facet_var
column_key=column_key,
format=TRUE,
ytextposition=FALSE
)+
# theme(strip.text.y = element_text(angle=0))+
# theme(axis.text.x = element_text(angle=90))+
#    scale_y_continuous("Percent of Obligations", labels = percent_format(accuracy=1))+
#      facet_grid(.~Competition.sum ,scales="free_x", space="free_x"
#             )+labs(title=NULL,
# x="Fiscal Year",
# y="Percent of Obligations",
# color="Competition")+
scale_y_continuous(expand=expansion(add=c(0,2e9)))+
theme(legend.position = "right")+
labs(y="Obligations (Constant 2021 $s)")+
facet_grid(SimpleArea~.,scales="free_y",space="free_y")
)
ggsave600dpi(SimpleArea,file="charts/SimpleArea.png",width=5,height=6,size = 11)
ggsave600dpi(SimpleArea,file="charts/SimpleArea.svg",width=5,height=6,size = 11)
ggsave600dpi(SimpleArea,file="charts/SimpleArea.svg",width=3.25,height=6,size = 11)
(
SimpleArea<-build_plot(
data=engine_contracts ,
chart_geom = "Bar Chart",
share = FALSE,
labels_and_colors=labels_and_colors,
# NA, #VAR.ncol
x_var="Fiscal_Year", #x_var
y_var="Action_Obligation_OMB23_GDP21", #VAR.y.variable
color_var="SimpleArea", #color_var
facet_var="SimpleArea", #facet_var
column_key=column_key,
format=TRUE,
ytextposition=FALSE
)+
# theme(strip.text.y = element_text(angle=0))+
# theme(axis.text.x = element_text(angle=90))+
#    scale_y_continuous("Percent of Obligations", labels = percent_format(accuracy=1))+
#      facet_grid(.~Competition.sum ,scales="free_x", space="free_x"
#             )+labs(title=NULL,
# x="Fiscal Year",
# y="Percent of Obligations",
# color="Competition")+
scale_y_continuous(expand=expansion(add=c(0,2e9)))+
theme(legend.position = "bottom")+
labs(y="Obligations (Constant 2021 $s)")+
facet_grid(SimpleArea~.,scales="free_y",space="free_y")
)
ggsave600dpi(SimpleArea,file="charts/SimpleArea.png",width=5,height=6,size = 11)
ggsave600dpi(SimpleArea,file="charts/SimpleArea.svg",width=3.25,height=6,size = 11)
(
SimpleArea<-build_plot(
data=engine_contracts ,
chart_geom = "Bar Chart",
share = FALSE,
labels_and_colors=labels_and_colors,
# NA, #VAR.ncol
x_var="Fiscal_Year", #x_var
y_var="Action_Obligation_OMB23_GDP21", #VAR.y.variable
color_var="SimpleArea", #color_var
facet_var="SimpleArea", #facet_var
column_key=column_key,
format=TRUE,
ytextposition=FALSE
)+
# theme(strip.text.y = element_text(angle=0))+
# theme(axis.text.x = element_text(angle=90))+
#    scale_y_continuous("Percent of Obligations", labels = percent_format(accuracy=1))+
#      facet_grid(.~Competition.sum ,scales="free_x", space="free_x"
#             )+labs(title=NULL,
# x="Fiscal Year",
# y="Percent of Obligations",
# color="Competition")+
scale_y_continuous(expand=expansion(add=c(0,2e9)),label = unit_format(unit = "M", scale = 1e-6))+
theme(legend.position = "bottom")+
labs(y="Obligations (Constant 2021 $s)")+
facet_grid(SimpleArea~.,scales="free_y",space="free_y")
)
??unit_format
(
SimpleArea<-build_plot(
data=engine_contracts ,
chart_geom = "Bar Chart",
share = FALSE,
labels_and_colors=labels_and_colors,
# NA, #VAR.ncol
x_var="Fiscal_Year", #x_var
y_var="Action_Obligation_OMB23_GDP21", #VAR.y.variable
color_var="SimpleArea", #color_var
facet_var="SimpleArea", #facet_var
column_key=column_key,
format=TRUE,
ytextposition=FALSE
)+
# theme(strip.text.y = element_text(angle=0))+
# theme(axis.text.x = element_text(angle=90))+
#    scale_y_continuous("Percent of Obligations", labels = percent_format(accuracy=1))+
#      facet_grid(.~Competition.sum ,scales="free_x", space="free_x"
#             )+labs(title=NULL,
# x="Fiscal Year",
# y="Percent of Obligations",
# color="Competition")+
scale_y_continuous(expand=expansion(add=c(0,2e9)),label = scales::unit_format(unit = "M", scale = 1e-6))+
theme(legend.position = "bottom")+
labs(y="Obligations (Constant 2021 $s)")+
facet_grid(SimpleArea~.,scales="free_y",space="free_y")
)
ggsave600dpi(SimpleArea,file="charts/SimpleArea.png",width=5,height=6,size = 11)
ggsave600dpi(SimpleArea,file="charts/SimpleArea.svg",width=3.25,height=6,size = 11)
(
SimpleArea<-build_plot(
data=engine_contracts ,
chart_geom = "Bar Chart",
share = FALSE,
labels_and_colors=labels_and_colors,
# NA, #VAR.ncol
x_var="Fiscal_Year", #x_var
y_var="Action_Obligation_OMB23_GDP21", #VAR.y.variable
color_var="SimpleArea", #color_var
facet_var="SimpleArea", #facet_var
column_key=column_key,
format=TRUE,
ytextposition=FALSE
)+
# theme(strip.text.y = element_text(angle=0))+
# theme(axis.text.x = element_text(angle=90))+
#    scale_y_continuous("Percent of Obligations", labels = percent_format(accuracy=1))+
#      facet_grid(.~Competition.sum ,scales="free_x", space="free_x"
#             )+labs(title=NULL,
# x="Fiscal Year",
# y="Percent of Obligations",
# color="Competition")+
scale_y_continuous(expand=expansion(add=c(0,1.5e9)),label = scales::unit_format(unit = "M", scale = 1e-6))+
theme(legend.position = "bottom")+
labs(y="Obligations (Constant 2021 $s)")+
facet_grid(SimpleArea~.,scales="free_y",space="free_y")
)
ggsave600dpi(SimpleArea,file="charts/SimpleArea.png",width=5,height=6,size = 11)
ggsave600dpi(SimpleArea,file="charts/SimpleArea.svg",width=3.25,height=6,size = 11)
gb<-read_csv("budget/data/FY23 PB Green Book Table 6-1.csv")
gb<-read_csv("budget/data/FY23 PB Green Book Table 6-1.csv",skip = 4)
gb<-read_csv("budget/data/FY23 PB Green Book Table 6-1.csv",skip = 3)
View(gb)
gb[6,]
rdte<-gb[6,]
rdte<-gb[6,c(1,4:ncol(gb))]
rdte
View(rdte)
as.numeric(sub("FY ","",colnames(rdte)))[2:ncol(rdte)]
sub("FY ","",colnames(rdte))[2:ncol(rdte)]
gb<-read_csv("budget/data/FY23 PB Green Book Table 6-1.csv",skip = 3)
rdte<-gb[6,c(1,4:ncol(gb)-1)]
sub("FY ","",colnames(rdte))[2:ncol(rdte)]
substr(colnames(rdte),4,7)[2:ncol(rdte)]
colnames(rdte)<-as.numeric(substr(colnames(rdte),4,7)[2:ncol(rdte)])
View(rdte)
load(file="app/engine_contract.Rdata")
any(duplicated(engine_contracts$csistransactionid))
source("C:/Users/gsand/Repositories/Engines/contracts/contract_processing.R", echo=TRUE)
labels_and_colors<-prepare_labels_and_colors(engine_contracts %>% select(-PricingMechanism))
column_key<-get_column_key(engine_contracts)
any(duplicated(engine_contracts$csistransactionid))
summary(factor(engine_contracts$SimpleArea))
engine_contracts<-
engine_contracts[,!colnames(engine_contracts) %in% c("TopProject","rank_2020","rank_total")]
colnames(engine_contracts)[colnames(engine_contracts)=="Action_Obligation_Then_Year_Then_Year"]<-
"Action_Obligation_Then_Year"
colnames(engine_contracts)[colnames(engine_contracts)=="Action_Obligation_Then_Year_OMB23_GDP21"]<-
"Action_Obligation_OMB23_GDP21"
topplat<-engine_contracts %>% group_by (Project.Name,SimpleArea) %>%
summarise(Action_Obligation_OMB23_GDP21=sum(Action_Obligation_OMB23_GDP21),
Action_Obligation_2020=sum(ifelse(Fiscal_Year==2020,Action_Obligation_OMB23_GDP21,0)))%>%
group_by (SimpleArea) %>%
mutate(rank_total=rank(desc(Action_Obligation_OMB23_GDP21)),
rank_2020=rank(desc(Action_Obligation_2020)))
topplat %>% arrange(desc(Action_Obligation_OMB23_GDP21))
topplat$TopProject<-
ifelse(topplat$rank_2020<=7 | topplat$rank_total<=7,topplat$Project.Name,NA)
engine_contracts<-left_join(engine_contracts,topplat %>% select(-Action_Obligation_OMB23_GDP21,-Action_Obligation_2020,
-rank_2020,-rank_total),
by=c("Project.Name","SimpleArea"))
engine_contracts$TopProject[is.na(engine_contracts$TopProject) & !is.na(engine_contracts$Project.Name)]<-
"Other Labeled Project"
summary(factor(engine_contracts$TopProject))
summary(factor(engine_contracts$ProjectPlatform))
engine_contracts<-
engine_contracts[,!colnames(engine_contracts) %in% c("topPSC","rank_2020","rank_total","TopPScode","TopPStext")]
topPSC<-engine_contracts %>% group_by (ProductOrServiceCode,ProductOrServiceCodeText,SimpleArea) %>%
summarise(Action_Obligation_OMB23_GDP21=sum(Action_Obligation_OMB23_GDP21),
Action_Obligation_2020=sum(ifelse(Fiscal_Year==2020,Action_Obligation_OMB23_GDP21,0)))%>%
group_by (SimpleArea) %>%
mutate(rank_total=rank(desc(Action_Obligation_OMB23_GDP21)),
rank_2020=rank(desc(Action_Obligation_2020)))
topPSC %>% arrange(desc(Action_Obligation_OMB23_GDP21))
topPSC$TopPScode<-
ifelse(topPSC$rank_2020<=7 | topPSC$rank_total<=7,topPSC$ProductOrServiceCode,NA)
topPSC$TopPStext<-
ifelse(topPSC$rank_2020<=7 | topPSC$rank_total<=7,topPSC$ProductOrServiceCodeText,NA)
engine_contracts<-left_join(engine_contracts,topPSC %>% select(-Action_Obligation_OMB23_GDP21,-Action_Obligation_2020,
-rank_2020,-rank_total,-ProductOrServiceCodeText),
by=c("ProductOrServiceCode","SimpleArea"))
engine_contracts$TopPScode[is.na(engine_contracts$TopPScode) & !is.na(engine_contracts$ProductOrServiceCode)]<-
"Other Labeled PSC"
engine_contracts$TopPStext[is.na(engine_contracts$TopPStext) & !is.na(engine_contracts$ProductOrServiceCode)]<-
"Other Labeled PSC"
engine_contracts$TopPStext<-factor_wrap(engine_contracts$TopPStext)
summary(factor(engine_contracts$TopPStext))
(
SimpleArea<-build_plot(
data=engine_contracts,
chart_geom = "Bar Chart",
share = FALSE,
labels_and_colors=labels_and_colors,
# NA, #VAR.ncol
x_var="Fiscal_Year", #x_var
y_var="Action_Obligation_OMB23_GDP21", #VAR.y.variable
color_var="SimpleArea", #color_var
facet_var="SimpleArea", #facet_var
column_key=column_key,
format=TRUE,
ytextposition=FALSE
)+
# theme(strip.text.y = element_text(angle=0))+
# theme(axis.text.x = element_text(angle=90))+
#    scale_y_continuous("Percent of Obligations", labels = percent_format(accuracy=1))+
#      facet_grid(.~Competition.sum ,scales="free_x", space="free_x"
#             )+labs(title=NULL,
# x="Fiscal Year",
# y="Percent of Obligations",
# color="Competition")+
scale_y_continuous(expand=expansion(add=c(0,1.5e9)),label = scales::unit_format(unit = "M", scale = 1e-6))+
theme(legend.position = "bottom")+
labs(y="Obligations (Constant 2021 $s)")+
facet_grid(SimpleArea~.,scales="free_y",space="free_y")
)
engine_contracts$SimpleArea.AETP<-engine_contracts$SimpleArea
engine_contracts$SimpleArea.AETP[engine_contracts$ProjectID==2260]<-"AETP"
(
SimpleArea<-build_plot(
data=engine_contracts,
chart_geom = "Bar Chart",
share = FALSE,
labels_and_colors=labels_and_colors,
# NA, #VAR.ncol
x_var="Fiscal_Year", #x_var
y_var="Action_Obligation_OMB23_GDP21", #VAR.y.variable
color_var="SimpleArea.AETP", #color_var
facet_var="SimpleArea.AETP", #facet_var
column_key=column_key,
format=TRUE,
ytextposition=FALSE
)+
# theme(strip.text.y = element_text(angle=0))+
# theme(axis.text.x = element_text(angle=90))+
#    scale_y_continuous("Percent of Obligations", labels = percent_format(accuracy=1))+
#      facet_grid(.~Competition.sum ,scales="free_x", space="free_x"
#             )+labs(title=NULL,
# x="Fiscal Year",
# y="Percent of Obligations",
# color="Competition")+
scale_y_continuous(expand=expansion(add=c(0,1.5e9)),label = scales::unit_format(unit = "M", scale = 1e-6))+
theme(legend.position = "bottom")+
labs(y="Obligations (Constant 2021 $s)")+
facet_grid(SimpleArea.AETP~.,scales="free_y",space="free_y")
)
ggsave600dpi(SimpleArea,file="charts/SimpleArea.png",width=5,height=6,size = 11)
ggsave600dpi(SimpleArea,file="charts/SimpleArea.svg",width=3.25,height=6,size = 11)
write.csv(file="charts//SimpleArea.csv",row.names = FALSE, na = "",
SimpleArea$data%>% #mutate(Fiscal_Year=lubridate::year(dFYear))%>%
pivot_wider(id_cols=c(SimpleArea),
names_from=Fiscal_Year,values_from=Action_Obligation_OMB23_GDP21))
(
RnDpsc<-build_plot(
data=engine_contracts %>% filter(SimpleArea=="R&D"),
chart_geom = "Line Chart",
share = FALSE,
# labels_and_colors=labels_and_colors,
# NA, #VAR.ncol
x_var="dFYear", #x_var
y_var="Action_Obligation_OMB23_GDP21", #VAR.y.variable
color_var="TopPStext", #color_var
facet_var="TopPStext", #facet_var
# column_key=column_key,
format=TRUE,
ytextposition=FALSE
)+scale_x_date("Fiscal Year",labels = scales::label_date("'%y"))+
# theme(strip.text.y = element_text(angle=0))+
# theme(axis.text.x = element_text(angle=90))+
#    scale_y_continuous("Percent of Obligations", labels = percent_format(accuracy=1))+
#      facet_grid(.~Competition.sum ,scales="free_x", space="free_x"
#             )+labs(title=NULL,
# x="Fiscal Year",
# y="Percent of Obligations",
# color="Competition")+
theme(legend.position = "none")+
labs(y="Obligations (Constant 2021 $s)")
)
(
RnD<-build_plot(
data=engine_contracts %>% filter(SimpleArea=="R&D"),
chart_geom = "Line Chart",
share = FALSE,
# labels_and_colors=labels_and_colors,
# NA, #VAR.ncol
x_var="dFYear", #x_var
y_var="Action_Obligation_OMB23_GDP21", #VAR.y.variable
color_var="TopProject", #color_var
facet_var="TopProject", #facet_var
# column_key=column_key,
format=TRUE,
ytextposition=FALSE
)+scale_x_date("Fiscal Year",labels = scales::label_date("'%y"))+
# theme(strip.text.y = element_text(angle=0))+
# theme(axis.text.x = element_text(angle=90))+
#    scale_y_continuous("Percent of Obligations", labels = percent_format(accuracy=1))+
#      facet_grid(.~Competition.sum ,scales="free_x", space="free_x"
#             )+labs(title=NULL,
# x="Fiscal Year",
# y="Percent of Obligations",
# color="Competition")+
theme(legend.position = "none")+
labs(y="Obligations (Constant 2021 $s)")
)
write.csv(file="charts//RnD_project_cur.csv",row.names = FALSE,na = "",
engine_contracts %>% filter(SimpleArea=="R&D")  %>%
format_data_for_plot(fy_var="Fiscal_Year",y_var="Action_Obligation_Then_Year",color_var = "TopProject"#,
# labels_and_colors=labels_and_colors
)%>% arrange(Fiscal_Year) %>%
pivot_wider(id_cols=c(TopProject),
names_from=Fiscal_Year,values_from=Action_Obligation_Then_Year)%>%
arrange(TopProject))
(
ProductsPSC<-build_plot(
data=engine_contracts %>% filter(SimpleArea=="Products"),
chart_geom = "Line Chart",
share = FALSE,
# labels_and_colors=labels_and_colors,
# NA, #VAR.ncol
x_var="dFYear", #x_var
y_var="Action_Obligation_OMB23_GDP21", #VAR.y.variable
color_var="TopPStext", #color_var
facet_var="TopPStext", #facet_var
# column_key=column_key,
format=TRUE,
ytextposition=FALSE
)+scale_x_date("Fiscal Year",labels = scales::label_date("'%y"))+
# theme(strip.text.y = element_text(angle=0))+
# theme(axis.text.x = element_text(angle=90))+
#    scale_y_continuous("Percent of Obligations", labels = percent_format(accuracy=1))+
#      facet_grid(.~Competition.sum ,scales="free_x", space="free_x"
#             )+labs(title=NULL,
# x="Fiscal Year",
# y="Percent of Obligations",
# color="Competition")+
theme(legend.position = "none")+
labs(y="Obligations (Constant 2021 $s)")
)
(
Products<-build_plot(
data=engine_contracts %>% filter(SimpleArea=="Products"),
chart_geom = "Line Chart",
share = FALSE,
# labels_and_colors=labels_and_colors,
# NA, #VAR.ncol
x_var="dFYear", #x_var
y_var="Action_Obligation_OMB23_GDP21", #VAR.y.variable
color_var="TopProject", #color_var
facet_var="TopProject", #facet_var
# column_key=column_key,
format=TRUE,
ytextposition=FALSE
)+scale_x_date("Fiscal Year",labels = scales::label_date("'%y"))+
# theme(strip.text.y = element_text(angle=0))+
# theme(axis.text.x = element_text(angle=90))+
#    scale_y_continuous("Percent of Obligations", labels = percent_format(accuracy=1))+
#      facet_grid(.~Competition.sum ,scales="free_x", space="free_x"
#             )+labs(title=NULL,
# x="Fiscal Year",
# y="Percent of Obligations",
# color="Competition")+
theme(legend.position = "none")+
labs(y="Obligations (Constant 2021 $s)")
)
write.csv(file="charts//products_project_cur.csv",row.names = FALSE,na = "",
engine_contracts %>% filter(SimpleArea=="Products")  %>%
format_data_for_plot(fy_var="Fiscal_Year",y_var="Action_Obligation_Then_Year",color_var = "TopProject"#,
# labels_and_colors=labels_and_colors
)%>% arrange(Fiscal_Year) %>%
pivot_wider(id_cols=c(TopProject),
names_from=Fiscal_Year,values_from=Action_Obligation_Then_Year)%>%
arrange(TopProject))
