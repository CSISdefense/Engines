# y="Percent of Obligations",
# color="Competition")+
theme(legend.position = "right")+
labs(y="Percent of Topline or Aircraft Portfolio Obligations")
# facet_grid(SimpleArea~.,scales="free_y")
)
ggsave600dpi(pSA,file="charts/pSimpleArea.svg",width=6.5,height=2.5,size = 11)
write.csv(file="charts//pSimpleArea.csv",row.names = FALSE, na = "",
pSA$data%>% #mutate(Fiscal_Year=lubridate::year(dFYear))%>%
pivot_wider(id_cols=c(SimpleArea,name),
names_from=Fiscal_Year,values_from=value))
pSimpleArea<-percent_contracts %>%
group_by(Fiscal_Year, SimpleArea) %>%
dplyr::summarise(Engines = sum(Engines, na.rm = TRUE),
Aircraft = sum(Aircraft, na.rm = TRUE),
Topline = sum(Topline, na.rm = TRUE))%>%
mutate(pTopline=Engines/Topline,
pAircraft=Engines/Aircraft)%>%
pivot_longer(cols=c(pTopline,pAircraft))
(
pSA<-build_plot(
data=pSimpleArea %>% filter(!is.na(SimpleArea)) ,
chart_geom = "Line Chart",
share = FALSE,
# labels_and_colors=labels_and_colors,
# NA, #VAR.ncol
x_var="Fiscal_Year", #x_var
y_var="value", #VAR.y.variable
color_var="name", #color_var
facet_var="SimpleArea", #facet_var
column_key=column_key,
format=FALSE,
ytextposition=FALSE
)+scale_y_continuous(labels=scales::percent)+
# theme(strip.text.y = element_text(angle=0))+
# theme(axis.text.x = element_text(angle=90))+
#    scale_y_continuous("Percent of Obligations", labels = percent_format(accuracy=1))+
#      facet_grid(.~Competition.sum ,scales="free_x", space="free_x"
#             )+labs(title=NULL,
# x="Fiscal Year",
# y="Percent of Obligations",
# color="Competition")+
theme(legend.position = "right")+
labs(y="Percent of Topline or\nAircraft Portfolio Obligations")
# facet_grid(SimpleArea~.,scales="free_y")
)
ggsave600dpi(pSA,file="charts/pSimpleArea.svg",width=6.5,height=2.5,size = 11)
write.csv(file="charts//pSimpleArea.csv",row.names = FALSE, na = "",
pSA$data%>% #mutate(Fiscal_Year=lubridate::year(dFYear))%>%
pivot_wider(id_cols=c(SimpleArea,name),
names_from=Fiscal_Year,values_from=value))
ggsave600dpi(pSA,file="charts/pSimpleArea.svg",width=6.5,height=2.5,size = 11,lineheight = 2)
ggsave600dpi(pSA,file="charts/pSimpleArea.svg",width=6.5,height=2.5,size = 11,lineheight = 1.2)
labels_and_colors<-prepare_labels_and_colors(engine_contracts %>% select(-PricingMechanism))
column_key<-get_column_key(engine_contracts)
(
SimpleArea<-build_plot(
data=engine_contracts ,
chart_geom = "Bar Chart",
share = FALSE,
labels_and_colors=labels_and_colors,
# NA, #VAR.ncol
x_var="Fiscal_Year", #x_var
y_var="Action_Obligation_OMB23_GDP21", #VAR.y.variable
color_var="SimpleArea", #color_var
facet_var="SimpleArea", #facet_var
column_key=column_key,
format=TRUE,
ytextposition=FALSE
)+
# theme(strip.text.y = element_text(angle=0))+
# theme(axis.text.x = element_text(angle=90))+
#    scale_y_continuous("Percent of Obligations", labels = percent_format(accuracy=1))+
#      facet_grid(.~Competition.sum ,scales="free_x", space="free_x"
#             )+labs(title=NULL,
# x="Fiscal Year",
# y="Percent of Obligations",
# color="Competition")+
theme(legend.position = "right")+
labs(y="Obligations (Constant 2021 $s), Variable Scale")+
facet_grid(SimpleArea~.,scales="free_y")
)
ggsave600dpi(SimpleArea,file="charts/SimpleArea.png",width=5,height=6,size = 11)
write.csv(file="charts//SimpleArea.csv",row.names = FALSE, na = "",
SimpleArea$data%>% #mutate(Fiscal_Year=lubridate::year(dFYear))%>%
pivot_wider(id_cols=c(SimpleArea),
names_from=Fiscal_Year,values_from=Action_Obligation_OMB23_GDP21))
grid.arrange(SimpleArea,pSA)
??grid.arrane
??grid.arrange
gridExtra::grid.arrange(SimpleArea,pSA)
gridExtra::grid.arrange(SimpleArea+labs(caption=NULL),pSA)
(
SimpleArea<-build_plot(
data=engine_contracts ,
chart_geom = "Bar Chart",
share = FALSE,
labels_and_colors=labels_and_colors,
# NA, #VAR.ncol
x_var="Fiscal_Year", #x_var
y_var="Action_Obligation_OMB23_GDP21", #VAR.y.variable
color_var="SimpleArea", #color_var
facet_var="SimpleArea", #facet_var
column_key=column_key,
format=TRUE,
ytextposition=FALSE
)+
# theme(strip.text.y = element_text(angle=0))+
# theme(axis.text.x = element_text(angle=90))+
#    scale_y_continuous("Percent of Obligations", labels = percent_format(accuracy=1))+
#      facet_grid(.~Competition.sum ,scales="free_x", space="free_x"
#             )+labs(title=NULL,
# x="Fiscal Year",
# y="Percent of Obligations",
# color="Competition")+
theme(legend.position = "right")+
labs(y="Obligations (Constant 2021 $s), Variable Scale")+
facet_grid(SimpleArea~.,scales="free_y",space="free_y")
)
?expansion
(
SimpleArea<-build_plot(
data=engine_contracts ,
chart_geom = "Bar Chart",
share = FALSE,
labels_and_colors=labels_and_colors,
# NA, #VAR.ncol
x_var="Fiscal_Year", #x_var
y_var="Action_Obligation_OMB23_GDP21", #VAR.y.variable
color_var="SimpleArea", #color_var
facet_var="SimpleArea", #facet_var
column_key=column_key,
format=TRUE,
ytextposition=FALSE
)+
# theme(strip.text.y = element_text(angle=0))+
# theme(axis.text.x = element_text(angle=90))+
#    scale_y_continuous("Percent of Obligations", labels = percent_format(accuracy=1))+
#      facet_grid(.~Competition.sum ,scales="free_x", space="free_x"
#             )+labs(title=NULL,
# x="Fiscal Year",
# y="Percent of Obligations",
# color="Competition")+
scale_x_continuous(expand=expansion(add=1e9))+
theme(legend.position = "right")+
labs(y="Obligations (Constant 2021 $s), Variable Scale")+
facet_grid(SimpleArea~.,scales="free_y",space="free_y")
)
(
SimpleArea<-build_plot(
data=engine_contracts ,
chart_geom = "Bar Chart",
share = FALSE,
labels_and_colors=labels_and_colors,
# NA, #VAR.ncol
x_var="Fiscal_Year", #x_var
y_var="Action_Obligation_OMB23_GDP21", #VAR.y.variable
color_var="SimpleArea", #color_var
facet_var="SimpleArea", #facet_var
column_key=column_key,
format=TRUE,
ytextposition=FALSE
)+
# theme(strip.text.y = element_text(angle=0))+
# theme(axis.text.x = element_text(angle=90))+
#    scale_y_continuous("Percent of Obligations", labels = percent_format(accuracy=1))+
#      facet_grid(.~Competition.sum ,scales="free_x", space="free_x"
#             )+labs(title=NULL,
# x="Fiscal Year",
# y="Percent of Obligations",
# color="Competition")+
scale_x_continuous(expand=expansion(add=1))+
theme(legend.position = "right")+
labs(y="Obligations (Constant 2021 $s), Variable Scale")+
facet_grid(SimpleArea~.,scales="free_y",space="free_y")
)
(
SimpleArea<-build_plot(
data=engine_contracts ,
chart_geom = "Bar Chart",
share = FALSE,
labels_and_colors=labels_and_colors,
# NA, #VAR.ncol
x_var="Fiscal_Year", #x_var
y_var="Action_Obligation_OMB23_GDP21", #VAR.y.variable
color_var="SimpleArea", #color_var
facet_var="SimpleArea", #facet_var
column_key=column_key,
format=TRUE,
ytextposition=FALSE
)+
# theme(strip.text.y = element_text(angle=0))+
# theme(axis.text.x = element_text(angle=90))+
#    scale_y_continuous("Percent of Obligations", labels = percent_format(accuracy=1))+
#      facet_grid(.~Competition.sum ,scales="free_x", space="free_x"
#             )+labs(title=NULL,
# x="Fiscal Year",
# y="Percent of Obligations",
# color="Competition")+
scale_x_continuous(expand=expansion(add=1e7))+
theme(legend.position = "right")+
labs(y="Obligations (Constant 2021 $s), Variable Scale")+
facet_grid(SimpleArea~.,scales="free_y",space="free_y")
)
(
SimpleArea<-build_plot(
data=engine_contracts ,
chart_geom = "Bar Chart",
share = FALSE,
labels_and_colors=labels_and_colors,
# NA, #VAR.ncol
x_var="Fiscal_Year", #x_var
y_var="Action_Obligation_OMB23_GDP21", #VAR.y.variable
color_var="SimpleArea", #color_var
facet_var="SimpleArea", #facet_var
column_key=column_key,
format=TRUE,
ytextposition=FALSE
)+
# theme(strip.text.y = element_text(angle=0))+
# theme(axis.text.x = element_text(angle=90))+
#    scale_y_continuous("Percent of Obligations", labels = percent_format(accuracy=1))+
#      facet_grid(.~Competition.sum ,scales="free_x", space="free_x"
#             )+labs(title=NULL,
# x="Fiscal Year",
# y="Percent of Obligations",
# color="Competition")+
scale_y_continuous(expand=expansion(add=1e9))+
theme(legend.position = "right")+
labs(y="Obligations (Constant 2021 $s), Variable Scale")+
facet_grid(SimpleArea~.,scales="free_y",space="free_y")
)
(
SimpleArea<-build_plot(
data=engine_contracts ,
chart_geom = "Bar Chart",
share = FALSE,
labels_and_colors=labels_and_colors,
# NA, #VAR.ncol
x_var="Fiscal_Year", #x_var
y_var="Action_Obligation_OMB23_GDP21", #VAR.y.variable
color_var="SimpleArea", #color_var
facet_var="SimpleArea", #facet_var
column_key=column_key,
format=TRUE,
ytextposition=FALSE
)+
# theme(strip.text.y = element_text(angle=0))+
# theme(axis.text.x = element_text(angle=90))+
#    scale_y_continuous("Percent of Obligations", labels = percent_format(accuracy=1))+
#      facet_grid(.~Competition.sum ,scales="free_x", space="free_x"
#             )+labs(title=NULL,
# x="Fiscal Year",
# y="Percent of Obligations",
# color="Competition")+
scale_y_continuous(expand=expansion(add=c(0,1e9)))+
theme(legend.position = "right")+
labs(y="Obligations (Constant 2021 $s), Variable Scale")+
facet_grid(SimpleArea~.,scales="free_y",space="free_y")
)
(
SimpleArea<-build_plot(
data=engine_contracts ,
chart_geom = "Bar Chart",
share = FALSE,
labels_and_colors=labels_and_colors,
# NA, #VAR.ncol
x_var="Fiscal_Year", #x_var
y_var="Action_Obligation_OMB23_GDP21", #VAR.y.variable
color_var="SimpleArea", #color_var
facet_var="SimpleArea", #facet_var
column_key=column_key,
format=TRUE,
ytextposition=FALSE
)+
# theme(strip.text.y = element_text(angle=0))+
# theme(axis.text.x = element_text(angle=90))+
#    scale_y_continuous("Percent of Obligations", labels = percent_format(accuracy=1))+
#      facet_grid(.~Competition.sum ,scales="free_x", space="free_x"
#             )+labs(title=NULL,
# x="Fiscal Year",
# y="Percent of Obligations",
# color="Competition")+
scale_y_continuous(expand=expansion(add=c(0,2e9)))+
theme(legend.position = "right")+
labs(y="Obligations (Constant 2021 $s), Variable Scale")+
facet_grid(SimpleArea~.,scales="free_y",space="free_y")
)
(
SimpleArea<-build_plot(
data=engine_contracts ,
chart_geom = "Bar Chart",
share = FALSE,
labels_and_colors=labels_and_colors,
# NA, #VAR.ncol
x_var="Fiscal_Year", #x_var
y_var="Action_Obligation_OMB23_GDP21", #VAR.y.variable
color_var="SimpleArea", #color_var
facet_var="SimpleArea", #facet_var
column_key=column_key,
format=TRUE,
ytextposition=FALSE
)+
# theme(strip.text.y = element_text(angle=0))+
# theme(axis.text.x = element_text(angle=90))+
#    scale_y_continuous("Percent of Obligations", labels = percent_format(accuracy=1))+
#      facet_grid(.~Competition.sum ,scales="free_x", space="free_x"
#             )+labs(title=NULL,
# x="Fiscal Year",
# y="Percent of Obligations",
# color="Competition")+
scale_y_continuous(expand=expansion(add=c(0,2e9),labels=money_labels))+
theme(legend.position = "right")+
labs(y="Obligations (Constant 2021 $s), Variable Scale")+
facet_grid(SimpleArea~.,scales="free_y",space="free_y")
)
(
SimpleArea<-build_plot(
data=engine_contracts ,
chart_geom = "Bar Chart",
share = FALSE,
labels_and_colors=labels_and_colors,
# NA, #VAR.ncol
x_var="Fiscal_Year", #x_var
y_var="Action_Obligation_OMB23_GDP21", #VAR.y.variable
color_var="SimpleArea", #color_var
facet_var="SimpleArea", #facet_var
column_key=column_key,
format=TRUE,
ytextposition=FALSE
)+
# theme(strip.text.y = element_text(angle=0))+
# theme(axis.text.x = element_text(angle=90))+
#    scale_y_continuous("Percent of Obligations", labels = percent_format(accuracy=1))+
#      facet_grid(.~Competition.sum ,scales="free_x", space="free_x"
#             )+labs(title=NULL,
# x="Fiscal Year",
# y="Percent of Obligations",
# color="Competition")+
scale_y_continuous(expand=expansion(add=c(0,2e9)))+
theme(legend.position = "right")+
labs(y="Obligations (Constant 2021 $s), Variable Scale")+
facet_grid(SimpleArea~.,scales="free_y",space="free_y")
)
ggsave600dpi(SimpleArea,file="charts/SimpleArea.png",width=5,height=6,size = 11)
(
SimpleArea<-build_plot(
data=engine_contracts ,
chart_geom = "Bar Chart",
share = FALSE,
labels_and_colors=labels_and_colors,
# NA, #VAR.ncol
x_var="Fiscal_Year", #x_var
y_var="Action_Obligation_OMB23_GDP21", #VAR.y.variable
color_var="SimpleArea", #color_var
facet_var="SimpleArea", #facet_var
column_key=column_key,
format=TRUE,
ytextposition=FALSE
)+
# theme(strip.text.y = element_text(angle=0))+
# theme(axis.text.x = element_text(angle=90))+
#    scale_y_continuous("Percent of Obligations", labels = percent_format(accuracy=1))+
#      facet_grid(.~Competition.sum ,scales="free_x", space="free_x"
#             )+labs(title=NULL,
# x="Fiscal Year",
# y="Percent of Obligations",
# color="Competition")+
scale_y_continuous(expand=expansion(add=c(0,2e9)))+
theme(legend.position = "right")+
labs(y="Obligations (Constant 2021 $s)")+
facet_grid(SimpleArea~.,scales="free_y",space="free_y")
)
ggsave600dpi(SimpleArea,file="charts/SimpleArea.png",width=5,height=6,size = 11)
ggsave600dpi(SimpleArea,file="charts/SimpleArea.svg",width=5,height=6,size = 11)
ggsave600dpi(SimpleArea,file="charts/SimpleArea.svg",width=3.25,height=6,size = 11)
(
SimpleArea<-build_plot(
data=engine_contracts ,
chart_geom = "Bar Chart",
share = FALSE,
labels_and_colors=labels_and_colors,
# NA, #VAR.ncol
x_var="Fiscal_Year", #x_var
y_var="Action_Obligation_OMB23_GDP21", #VAR.y.variable
color_var="SimpleArea", #color_var
facet_var="SimpleArea", #facet_var
column_key=column_key,
format=TRUE,
ytextposition=FALSE
)+
# theme(strip.text.y = element_text(angle=0))+
# theme(axis.text.x = element_text(angle=90))+
#    scale_y_continuous("Percent of Obligations", labels = percent_format(accuracy=1))+
#      facet_grid(.~Competition.sum ,scales="free_x", space="free_x"
#             )+labs(title=NULL,
# x="Fiscal Year",
# y="Percent of Obligations",
# color="Competition")+
scale_y_continuous(expand=expansion(add=c(0,2e9)))+
theme(legend.position = "bottom")+
labs(y="Obligations (Constant 2021 $s)")+
facet_grid(SimpleArea~.,scales="free_y",space="free_y")
)
ggsave600dpi(SimpleArea,file="charts/SimpleArea.png",width=5,height=6,size = 11)
ggsave600dpi(SimpleArea,file="charts/SimpleArea.svg",width=3.25,height=6,size = 11)
(
SimpleArea<-build_plot(
data=engine_contracts ,
chart_geom = "Bar Chart",
share = FALSE,
labels_and_colors=labels_and_colors,
# NA, #VAR.ncol
x_var="Fiscal_Year", #x_var
y_var="Action_Obligation_OMB23_GDP21", #VAR.y.variable
color_var="SimpleArea", #color_var
facet_var="SimpleArea", #facet_var
column_key=column_key,
format=TRUE,
ytextposition=FALSE
)+
# theme(strip.text.y = element_text(angle=0))+
# theme(axis.text.x = element_text(angle=90))+
#    scale_y_continuous("Percent of Obligations", labels = percent_format(accuracy=1))+
#      facet_grid(.~Competition.sum ,scales="free_x", space="free_x"
#             )+labs(title=NULL,
# x="Fiscal Year",
# y="Percent of Obligations",
# color="Competition")+
scale_y_continuous(expand=expansion(add=c(0,2e9)),label = unit_format(unit = "M", scale = 1e-6))+
theme(legend.position = "bottom")+
labs(y="Obligations (Constant 2021 $s)")+
facet_grid(SimpleArea~.,scales="free_y",space="free_y")
)
??unit_format
(
SimpleArea<-build_plot(
data=engine_contracts ,
chart_geom = "Bar Chart",
share = FALSE,
labels_and_colors=labels_and_colors,
# NA, #VAR.ncol
x_var="Fiscal_Year", #x_var
y_var="Action_Obligation_OMB23_GDP21", #VAR.y.variable
color_var="SimpleArea", #color_var
facet_var="SimpleArea", #facet_var
column_key=column_key,
format=TRUE,
ytextposition=FALSE
)+
# theme(strip.text.y = element_text(angle=0))+
# theme(axis.text.x = element_text(angle=90))+
#    scale_y_continuous("Percent of Obligations", labels = percent_format(accuracy=1))+
#      facet_grid(.~Competition.sum ,scales="free_x", space="free_x"
#             )+labs(title=NULL,
# x="Fiscal Year",
# y="Percent of Obligations",
# color="Competition")+
scale_y_continuous(expand=expansion(add=c(0,2e9)),label = scales::unit_format(unit = "M", scale = 1e-6))+
theme(legend.position = "bottom")+
labs(y="Obligations (Constant 2021 $s)")+
facet_grid(SimpleArea~.,scales="free_y",space="free_y")
)
ggsave600dpi(SimpleArea,file="charts/SimpleArea.png",width=5,height=6,size = 11)
ggsave600dpi(SimpleArea,file="charts/SimpleArea.svg",width=3.25,height=6,size = 11)
(
SimpleArea<-build_plot(
data=engine_contracts ,
chart_geom = "Bar Chart",
share = FALSE,
labels_and_colors=labels_and_colors,
# NA, #VAR.ncol
x_var="Fiscal_Year", #x_var
y_var="Action_Obligation_OMB23_GDP21", #VAR.y.variable
color_var="SimpleArea", #color_var
facet_var="SimpleArea", #facet_var
column_key=column_key,
format=TRUE,
ytextposition=FALSE
)+
# theme(strip.text.y = element_text(angle=0))+
# theme(axis.text.x = element_text(angle=90))+
#    scale_y_continuous("Percent of Obligations", labels = percent_format(accuracy=1))+
#      facet_grid(.~Competition.sum ,scales="free_x", space="free_x"
#             )+labs(title=NULL,
# x="Fiscal Year",
# y="Percent of Obligations",
# color="Competition")+
scale_y_continuous(expand=expansion(add=c(0,1.5e9)),label = scales::unit_format(unit = "M", scale = 1e-6))+
theme(legend.position = "bottom")+
labs(y="Obligations (Constant 2021 $s)")+
facet_grid(SimpleArea~.,scales="free_y",space="free_y")
)
ggsave600dpi(SimpleArea,file="charts/SimpleArea.png",width=5,height=6,size = 11)
ggsave600dpi(SimpleArea,file="charts/SimpleArea.svg",width=3.25,height=6,size = 11)
gb<-read_csv("budget/data/FY23 PB Green Book Table 6-1.csv")
gb<-read_csv("budget/data/FY23 PB Green Book Table 6-1.csv",skip = 4)
gb<-read_csv("budget/data/FY23 PB Green Book Table 6-1.csv",skip = 3)
View(gb)
gb[6,]
rdte<-gb[6,]
rdte<-gb[6,c(1,4:ncol(gb))]
rdte
View(rdte)
as.numeric(sub("FY ","",colnames(rdte)))[2:ncol(rdte)]
sub("FY ","",colnames(rdte))[2:ncol(rdte)]
gb<-read_csv("budget/data/FY23 PB Green Book Table 6-1.csv",skip = 3)
rdte<-gb[6,c(1,4:ncol(gb)-1)]
sub("FY ","",colnames(rdte))[2:ncol(rdte)]
substr(colnames(rdte),4,7)[2:ncol(rdte)]
colnames(rdte)<-as.numeric(substr(colnames(rdte),4,7)[2:ncol(rdte)])
View(rdte)
