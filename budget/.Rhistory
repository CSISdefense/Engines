library(tidyverse)
library(Cairo)
library(ggthemes)
library(car)
library(extrafont)
# theme --------------------------------------------------------------------------
source("chart_theme.R")
source("money_labels.R")
# read data ----------------------------------------------------------------------
d19 <- read.csv("19.csv")
d18 <- read.csv("18.csv")
d17 <- read.csv("17.csv")
d16 <- read.csv("16.csv")
d15 <- read.csv("15.csv")
d14 <- read.csv("14.csv")
d13 <- read.csv("13.csv")
d12 <- read.csv("12.csv")
d11 <- read.csv("11.csv")
d10 <- read.csv("10.csv")
d09 <- read.csv("09.csv")
d08 <- read.csv("08.csv")
d07 <- read.csv("07.csv")
d06 <- read.csv("06.csv")
d05 <- read.csv("05.csv")
d04 <- read.csv("04.csv")
d03 <- read.csv("03.csv")
d02 <- read.csv("02.csv")
d01 <- read.csv("01.csv")
d00 <- read.csv("00.csv")
d99 <- read.csv("99.csv")
names(d19)[1] <- "FYDP.Year"
names(d18)[1] <- "FYDP.Year"
names(d17)[1] <- "FYDP.Year"
names(d16)[1] <- "FYDP.Year"
# long data ----------------------------------------------------------------------
d19 <- d19 %>%
gather(`X2017`:`X2023`, key = "FY", value = "Amount")
d18 <- d18 %>%
gather(`X2016`:`X2022`, key = "FY", value = "Amount")
d17 <- d17 %>%
gather(`X2015`:`X2021`, key = "FY", value = "Amount")
d16 <- d16 %>%
gather(`X2014`:`X2020`, key = "FY", value = "Amount")
d15 <- d15 %>%
gather(`X2013`:`X2019`, key = "FY", value = "Amount")
d14 <- d14 %>%
gather(`X2012`:`X2018`, key = "FY", value = "Amount")
d13 <- d13 %>%
gather(`X2011`:`X2017`, key = "FY", value = "Amount")
d12 <- d12 %>%
gather(`X2010`:`X2016`, key = "FY", value = "Amount")
d11 <- d11 %>%
gather(`X2009`:`X2015`, key = "FY", value = "Amount")
d10 <- d10 %>%
gather(`X2008`:`X2014`, key = "FY", value = "Amount")
d09 <- d09 %>%
gather(`X2007`:`X2013`, key = "FY", value = "Amount")
d08 <- d08 %>%
gather(`X2006`:`X2013`, key = "FY", value = "Amount")
d07 <- d07 %>%
gather(`X2005`:`X2011`, key = "FY", value = "Amount")
d06 <- d06 %>%
gather(`X2004`:`X2011`, key = "FY", value = "Amount")
d05 <- d05 %>%
gather(`X2003`:`X2009`, key = "FY", value = "Amount")
d04 <- d04 %>%
gather(`X2002`:`X2009`, key = "FY", value = "Amount")
d03 <- d03 %>%
gather(`X2001`:`X2007`, key = "FY", value = "Amount")
d02 <- d02 %>%
gather(`X2000`:`X2007`, key = "FY", value = "Amount")
d01 <- d01 %>%
gather(`X1999`:`X2005`, key = "FY", value = "Amount")
d00 <- d00 %>%
gather(`X1998`:`X2005`, key = "FY", value = "Amount")
d99 <- d99 %>%
gather(`X1997`:`X2003`, key = "FY", value = "Amount")
# combine data -------------------------------------------------------------------
engine_budget <- rbind(
d99,
d00,
d01,
d02,
d03,
d04,
d05,
d06,
d07,
d08,
d09,
d10,
d11,
d12,
d13,
d14,
d15,
d16,
d17,
d18,
d19
)
# add F135 -----------------------------------------------------------------------
service_ratio <- read_csv("service_ratio.csv")
f135 <- read_csv("f135_spending.csv")
f135 <- f135 %>%
left_join(service_ratio)
f135$FY <- str_c("X", f135$FY)
f135_navy <- f135 %>%
mutate(Amount = Amount * navy_ratio) %>%
mutate(Force = "Navy") %>%
select("FYDP.Year",
"Type",
"Force",
"Program.Number",
"Program.Name",
"Project.Number",
"Project.Name",
"FY",
"Amount") %>%
mutate(Project.Number = "2261")
f135_navy$Program.Number <- str_c(f135_navy$Program.Number, "N")
f135_air_force <- f135 %>%
mutate(Amount = Amount * air_force_ratio) %>%
mutate(Force = "Air Force") %>%
select("FYDP.Year",
"Type",
"Force",
"Program.Number",
"Program.Name",
"Project.Number",
"Project.Name",
"FY",
"Amount") %>%
mutate(Project.Number = "653831")
f135_air_force$Program.Number <- str_c(f135_air_force$Program.Number, "F")
f135 <- rbind(f135_navy, f135_air_force)
# add F136 -----------------------------------------------------------------------
service_ratio <- read_csv("service_ratio.csv")
f136 <- read_csv("f136_spending.csv")
f136 <- f136 %>%
left_join(service_ratio)
f136$FY <- str_c("X", f136$FY)
f136_navy <- f136 %>%
mutate(Amount = Amount * navy_ratio) %>%
mutate(Force = "Navy") %>%
select("FYDP.Year",
"Type",
"Force",
"Program.Number",
"Program.Name",
"Project.Number",
"Project.Name",
"FY",
"Amount") %>%
mutate(Project.Number = "2261")
f136_navy$Program.Number <- str_c(f136_navy$Program.Number, "N")
f136_air_force <- f136 %>%
mutate(Amount = Amount * air_force_ratio) %>%
mutate(Force = "Air Force") %>%
select("FYDP.Year",
"Type",
"Force",
"Program.Number",
"Program.Name",
"Project.Number",
"Project.Name",
"FY",
"Amount") %>%
mutate(Project.Number = "653831")
f136_air_force$Program.Number <- str_c(f136_air_force$Program.Number, "F")
f136 <- rbind(f136_navy, f136_air_force)
# combine engine_budget with F135 and F136----------------------------------------
f135_f136 <- rbind(f135, f136)
engine_budget <- engine_budget %>%
rbind(f135_f136)
# %>%
#   group_by(FYDP.Year,
#            Type,
#            Force,
#            Program.Number,
#            Program.Name,
#            Project.Number,
#            Project.Name,
#            FY) %>%
#   summarize(Amount = sum(Amount, na.rm = TRUE))
# clean data ---------------------------------------------------------------------
deflator <-
c(
0.7097926468,
0.7267816693,
0.7385433002,
0.7526572574,
0.7713016205,
0.7955218679,
0.821397456,
0.8437009932,
0.8612127548,
0.8712319219,
0.8788987629,
0.8967590173,
0.9131381774,
0.9285589824,
0.9454608817,
0.9568740199,
0.9679386653,
0.984579195,
1,
1.016727653,
1.035546262
)
fy <- c(2000:2020)
deflate_year <- as.data.frame(cbind(fy, deflator))
engine_budget <- engine_budget %>%
separate(FY, into = c("X", "FY"), sep = 1) %>%
dplyr::rename(
fydp_year = FYDP.Year,
account = Type,
organization = Force,
program_number = Program.Number,
program_name = Program.Name,
project_number = Project.Number,
project_name = Project.Name,
amount = Amount,
fy = FY
) %>%
mutate(fy = as.numeric(fy)) %>%
dplyr::left_join(deflate_year, by = "fy") %>%
mutate(amount_18 = amount / deflator) %>%
dplyr::mutate(fydp_year = as.factor(fydp_year)) %>%
dplyr::mutate(fydp = "FYDP") %>%
unite(fydp_year, fydp_year, fydp, sep = " ") %>%
select(fydp_year:project_name, fy, amount, amount_18) %>%
dplyr::mutate(
project_name = recode(
project_name,
"'Acft Demo Engines' = 'ACFT Demo Engines';
'ACFT Demo Engines ' = 'ACFT Demo Engines';
'Aircraft Demonstration Engine' = 'ACFT Demo Engines';
'Aircraft Demonstration Engines' = 'ACFT Demo Engines';
'Adv Propulsion Rsch' = 'Advanced Propulsion Research';
'Adv Propulsion' = 'Advanced Propulsion Research';
'Aerospace Fuels and Atmospheric Propulsion' = 'Aerospace Fuels';
'Aircraft Engine Component Improvement Program (CIP) (USN)' = 'Aircraft Engine Component Improvement Program (USN)';
'Aircraft Engine Component Improvement Program (CIP) (USA)' = 'Aircraft Engine Component Improvement Program (USA)';
'Aircraft Engine Component Improvement Program' = 'Aircraft Engine Component Improvement Program (USAF)';
'Aircraft Engine CIP' = 'Aircraft Engine Component Improvement Program (USN)';
'Aircraft Component Improvement Program (CIP)' = 'Aircraft Engine Component Improvement Program (USA)';
'A/C Eng Comp Imp (CIP)' = 'Aircraft Engine Component Improvement Program (USN)';
'Acft Engines Comp Imp Prog' = 'Aircraft Engine Component Improvement Program (USN)';
'F-35' = 'F135 Aircraft Engine Component Improvement Program';
'Aircraft Propulsion Subsystem Integration' = 'Aircraft Propulsion Subsystems Int';
'Vehicle Propulsion and Structures Technology' = 'Veh Prop & Struct Tech';
'Propulsion and Power Component Improvement Program' = 'Aircraft Engine Component Improvement Program (USN)';
'Aircraft Engine Component Improvement Program (CIP)' = 'Aircraft Engine Component Improvement Program (USA)';
'A/C Compon Improv Prog' = 'Aircraft Engine Component Improvement Program (USA)';
'F135 Aircraft Engine Component Improvement Program' = 'Aircraft Engine Component Improvement Program (F135)';
'Materials for Structures, Propulsion and Subsystems' = 'Materials for Structures, Propulsion, and Subsystems';
'Fuels and Lubrication' = 'Combustion and Mechanical Systems';
'Propulsion' = 'Advanced Aerospace Propulsion';
'Aerospace Fuel Technology' = 'Combustion and Mechanical Systems'"
)
)
# note: the funding in the last project (above) was moved from PE 0602203F Project 3048 starting in FY 2010
# to more accurately align efforts with organizational structure.
# join stages --------------------------------------------------------------------
stages <- read.csv("stages_join.csv")
stages <- stages %>%
dplyr::rename(stage = "Ã¯..Stage") %>%
dplyr::rename(project_name = "Project.Name")
engine_budget <- engine_budget %>%
left_join(stages, by = "project_name") %>%
mutate(amount = amount * 1000000)
# --------------------------------------------------------------------------------
engine_budget_wide <-
spread(engine_budget, key = "fy", value = "amount") # to view discrepancies
engine_budget <- engine_budget %>%
filter(
project_name %in% c(
"ACFT Demo Engines",
# "Adv Propulsion",
"Advanced Aerospace Propulsion",
"Advanced Propulsion Research",
"Advanced Propulsion Technology",
"Advanced Turbine Engine Gas Generator",
# "Aerospace Fuel Technology",
"Aerospace Fuels",
"Aircraft Engine Component Improvement Program (F135)",
"Aircraft Engine Component Improvement Program (USA)",
"Aircraft Engine Component Improvement Program (USAF)",
"Aircraft Engine Component Improvement Program (USN)",
"Aircraft Propulsion Subsystems Int",
"AV-8B",
# "Aviation Advanced Technology Initiatives",
"Combustion and Mechanical Systems",
# "Fuels and Lubrication",
"Improved Turbine Engine Program",
# "Materials",
"Materials for Structures, Propulsion, and Subsystems",
# "Materials Technology for Sustainment",
# "Materials Transition",
# "Propulsion",
# "Propulsion ",
"Turbine Engine Technology",
# "Vectored Thrust Ducted Propeller (CA)",
"Veh Prop & Struct Tech",
"F135",
"F136"
)
) %>%
filter(fydp_year != "1999 FYDP")
engine_budget_wide <-
spread(engine_budget, key = "fy", value = "amount") # to view discrepancies
# ================================================================================
engine_budget_future <- engine_budget %>%
mutate(fy = as.numeric(fy)) %>%
group_by(fydp_year, fy) %>%
filter(amount != 0) %>%
dplyr::summarize(amount = sum(amount, na.rm = TRUE))
engine_budget_future_wide <-
spread(engine_budget_future, key = "fy", value = "amount")
(
plot_ebf <- ggplot(engine_budget_future) +
geom_line(aes(
x = fy,
y = amount,
group = fydp_year,
color = fydp_year
), size = 1) +
# geom_smooth(aes(x = fy, y = amount, group = fydp_year, color = fydp_year), se = FALSE) +
chart_theme +
scale_y_continuous(labels = money_labels) +
xlab("fiscal year")
)
ggsave(
"engine budget future, color by year.svg",
plot_ebf,
device = "svg",
width = 8,
height = 6,
units = "in"
)
engine_budget_future <- engine_budget %>%
mutate(fy = as.numeric(fy)) %>%
group_by(fydp_year, fy, organization) %>%
filter(amount != 0) %>%
dplyr::summarize(amount = sum(amount, na.rm = TRUE))
engine_budget_future_wide <-
spread(engine_budget_future, key = "fy", value = "amount")
(
plot_ebf <- ggplot(engine_budget_future) +
geom_line(
aes(
x = fy,
y = amount,
group = fydp_year,
alpha = fydp_year
),
color = "#554449",
size = 1
) +
# geom_smooth(aes(x = fy, y = amount, group = fydp_year, color = fydp_year), se = FALSE) +
facet_wrap( ~ organization) +
scale_y_continuous(labels = money_labels) +
scale_x_continuous(
breaks = seq(1999, 2023, by = 2),
labels = function(x) {
substring(as.character(x), 3, 4)
}
) +
chart_theme +
xlab("fiscal year")
)
ggsave(
"engine budget future, facet wrap by branch.svg",
plot_ebf,
device = "svg",
width = 12,
height = 6,
units = "in"
)
engine_budget_future <- engine_budget %>%
mutate(fy = as.numeric(fy)) %>%
group_by(fydp_year, fy, project_name) %>%
filter(amount != 0) %>%
dplyr::summarize(amount = sum(amount, na.rm = TRUE))
engine_budget_future_wide <-
spread(engine_budget_future, key = "fy", value = "amount")
(
plot_ebf <- ggplot(engine_budget_future) +
geom_line(
aes(
x = fy,
y = amount,
group = fydp_year,
alpha = fydp_year
),
color = "#554449",
size = 1
) +
# geom_smooth(aes(x = fy, y = amount, group = fydp_year, color = fydp_year), se = FALSE) +
facet_wrap( ~ project_name) +
scale_y_continuous(labels = money_labels) +
scale_x_continuous(
breaks = seq(1999, 2023, by = 2),
labels = function(x) {
substring(as.character(x), 3, 4)
}
) +
chart_theme +
xlab("fiscal year")
)
ggsave(
"engine budget future, facet wrap by project name.svg",
plot_ebf,
device = "svg",
width = 20,
height = 10,
units = "in"
)
engine_budget_future <- engine_budget %>%
mutate(fy = as.numeric(fy)) %>%
filter(stage != "NA") %>%
group_by(fydp_year, fy, stage) %>%
filter(amount != 0) %>%
dplyr::summarize(amount = sum(amount, na.rm = TRUE))
engine_budget_future_wide <-
spread(engine_budget_future, key = "fy", value = "amount")
(
plot_ebf <- ggplot(engine_budget_future) +
geom_line(
aes(
x = fy,
y = amount,
group = fydp_year,
alpha = fydp_year
),
color = "#554449",
size = 1
) +
# geom_smooth(aes(x = fy, y = amount, group = fydp_year, color = fydp_year), se = FALSE) +
facet_wrap( ~ stage) +
scale_y_continuous(labels = money_labels) +
scale_x_continuous(
breaks = seq(1999, 2023, by = 2),
labels = function(x) {
substring(as.character(x), 3, 4)
}
) +
chart_theme +
xlab("fiscal year")
)
ggsave(
"engine budget future, facet wrap by stage.svg",
plot_ebf,
device = "svg",
width = 10,
height = 8,
units = "in"
)
engine_budget_future <- engine_budget %>%
mutate(fy = as.numeric(fy)) %>%
mutate(stage = factor(
stage,
levels = c("Basic Research",
"Applied Research",
"Advanced Technology Development",
"System Development & Demonstration",
"Operational Systems Development"))) %>%
mutate(organization = factor(
organization,
levels = c("Army",
"Navy",
"Air Force"))) %>%
filter(stage != "NA") %>%
group_by(fydp_year, fy, organization, stage) %>%
filter(amount != 0) %>%
dplyr::summarize(amount = sum(amount, na.rm = TRUE))
engine_budget_future_wide <-
spread(engine_budget_future, key = "fy", value = "amount")
(
plot_ebf <- ggplot(engine_budget_future) +
geom_line(
aes(
x = fy,
y = amount,
group = fydp_year,
alpha = fydp_year
),
color = "#554449",
size = 1
) +
# geom_smooth(aes(x = fy, y = amount, group = fydp_year, color = fydp_year), se = FALSE) +
facet_grid(organization ~ stage) +
scale_y_continuous(labels = money_labels) +
scale_x_continuous(
breaks = seq(1999, 2023, by = 2),
labels = function(x) {
substring(as.character(x), 3, 4)
}
) +
ggtitle("Future Years Defense Program by RDT&E Stage and Service") +
chart_theme +
xlab("fiscal year")
)
ggsave(
"engine budget future, facet grid by stage and organization.svg",
plot_ebf,
device = "svg",
width = 14,
height = 8,
units = "in"
)
